<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±Ø§Ø¯</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    .stats {
  transition: opacity 0.4s ease;
}


   body {
  margin: 0;
  font-family: 'Tajawal', sans-serif;
  display: flex;
  height: 100vh;
  background: linear-gradient(180deg, #f8f9fb 0%, #eef2f7 100%);
  overflow: hidden;
  color: #043B64;
}


    /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ */
    .sidebar {
      width: 260px;
      background-color: #043B64;
      color: white;
      display: flex;
      flex-direction: column;
      transition: transform 0.3s ease;
      z-index: 1000;
    }

    .sidebar h2 {
      text-align: center;
      background-color: #FF6B2D;
      padding: 15px;
      margin: 0;
      font-size: 18px;
    }

    .menu-item {
      padding: 15px 20px;
      cursor: pointer;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .menu-item:hover {
      background-color: rgba(255,255,255,0.1);
    }

    .submenu {
      background-color: #064b7a;
      display: none;
    }

    .submenu div {
      padding: 10px 40px;
      font-size: 14px;
      cursor: pointer;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .submenu div:hover {
      background-color: rgba(255,255,255,0.15);
    }

    /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
    .content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      position: relative;
    }

    .header {
      font-size: 22px;
      color: #043B64;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .menu-toggle {
      display: none;
      font-size: 24px;
      background: none;
      border: none;
      color: #043B64;
      cursor: pointer;
    }
/* ğŸŸ¢ Ø´Ø¨ÙƒØ© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª â€“ Ù…ÙˆØ¨Ø§ÙŠÙ„ 3 Ø¹Ù†Ø§ØµØ± */
.stats {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
  margin-top: 15px;
}

@media (min-width: 768px) {
  .stats {
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  }
}

/* ğŸ”µ Ø¹Ù†ØµØ± Ø§Ù„Ø­Ø§Ù„Ø© */
.status-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  cursor: pointer;
}

/* ğŸ”˜ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© */
.circle {
  width: 90px;
  height: 90px;
  border-radius: 50%;
  background: conic-gradient(var(--color) var(--percent), #e6ecf2 0);
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  transition: background 0.7s ease;
}


/* âšª Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© */
.circle::after {
  content: "";
  width: 68px;
  height: 68px;
  background: #fff;
  border-radius: 50%;
  position: absolute;
}

/* ğŸ”¢ Ø§Ù„Ø±Ù‚Ù… */
.circle span {
  position: relative;
  z-index: 1;
  font-size: 20px;
  font-weight: 700;
  color: var(--color);
}

/* ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */
.status-item h3 {
  font-size: 13px;
  text-align: center;
  margin: 0;
  color: #043B64;
}



    .logout {
      background: #FF6B2D;
      border: none;
      padding: 10px;
      color: white;
      border-radius: 6px;
      margin: 15px;
      cursor: pointer;
    }

    .logout:hover {
      opacity: 0.9;
    }

    @media (max-width: 768px) {
  .sidebar {
    position: fixed;
    top: 0;
    bottom: 0;
    right: 0;
    transform: translateX(100%);
  }

  .sidebar.active {
    transform: translateX(0);
  }

  .menu-toggle {
    display: block;
  }
}

/* âœ… Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù‡Ù†Ø§ */
h1, h2, h3, h4, h5, h6 {
  font-weight: 700;
}

p, div, span, button {
  font-weight: 500;
}

</style>

</head>
<body>

  <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
  <div class="sidebar" id="sidebar">
    <h2>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±Ø§Ø¯ âš™ï¸</h2>

    <!-- ğŸŸ£ Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
    <div class="menu-item" onclick="toggleMenu('ordersMenu')">ğŸ“¦ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
    <div class="submenu" id="ordersMenu">
      <div onclick="openOrders('')">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</div>
      <div onclick="openOrders('Ù…Ø«Ø¨Øª')">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø«Ø¨ØªØ©</div>
      <div onclick="openOrders('Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©')">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</div>
      <div onclick="openOrders('Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²')">Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²</div>
      <div onclick="openOrders('Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„')">Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„</div>
      <div onclick="openOrders('ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…')">ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</div>
      <div onclick="openOrders('Ø±Ø§Ø¬Ø¹')">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø±Ø§Ø¬Ø¹Ø©</div>
      <div onclick="openOrders('Ø±ÙØ¶')">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø©</div>
      <div onclick="openOrders('Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø©')">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø©</div>
      <div onclick="openOrders('Ø­Ø§Ù„Ø§Øª Ø£Ø®Ø±Ù‰')">Ø­Ø§Ù„Ø§Øª Ø£Ø®Ø±Ù‰</div>


      <div style="background:#FF6B2D;color:white;font-weight:bold;text-align:center;cursor:pointer" onclick="openNewOrder()">â• Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</div>
    </div>

    <!-- ğŸ’° Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª -->
<div class="menu-item" onclick="toggleMenu('financeMenu')">ğŸ’° Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</div>
<div class="submenu" id="financeMenu">
  <div onclick="openFinance('sales')">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</div>
  <div onclick="openFinance('expenses')">Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</div>
  <div onclick="openFinance('profits')">Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø±</div>
  <div onclick="openFinance('suppliers')">Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</div>
  <div onclick="openFinance('balances')">Ø§Ù„Ø£Ø±ØµØ¯Ø©</div>
</div>

<!-- ğŸ¬ Ø§Ù„Ù…Ø®Ø²Ù† -->
<div class="menu-item" onclick="toggleMenu('storeMenu')">ğŸ¬ Ø§Ù„Ù…Ø®Ø²Ù†</div>
<div class="submenu" id="storeMenu">
<div onclick="window.location.href='warehouse.html'">ğŸ¬ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</div>
<div onclick="window.location.href='warehouse-details.html'">ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
  <div onclick="openStore('purchases')">Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</div>
  <div onclick="openStore('daily')">ğŸ“… Ø§Ù„Ø¬Ø±Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ</div>
  <div onclick="openStore('losses')">Ø§Ù„ØªØ§Ù„Ù ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø±</div>
  <div onclick="openStore('summary')">Ø§Ù„Ø¬Ø±Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ</div>
</div>

    <!-- ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
<!-- ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
<div class="menu-item" onclick="toggleMenu('statsMenu')">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</div>
<div class="submenu" id="statsMenu">
  <div onclick="openStatistics('orders')">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
  <div onclick="openStatistics('employees')">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</div>
  <div onclick="openStatistics('products')">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
  <div onclick="openStatistics('advertisers')">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¹Ù„Ù†ÙŠÙ†</div>
  <div onclick="openStatistics('daily')">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</div>
</div>

<!-- ğŸ—‚ï¸ Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø´Ù‡Ø±ÙŠ -->
<div class="menu-item" onclick="openArchive()">ğŸ—‚ï¸ Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø´Ù‡Ø±ÙŠ</div>

    <!-- ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (ØªØ¸Ù‡Ø± ÙÙ‚Ø· Ù„Ù„Ø£Ø¯Ù…Ù†) -->
<div class="menu-item" id="usersMenu" style="display:none;" onclick="openUsers()">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>


    <!-- ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ -->
    <button class="logout" onclick="logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
  </div>

  <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
  <div class="content">
<div class="header">


  <span id="sectionTitle">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
  <button class="menu-toggle" onclick="toggleSidebar()">â˜°</button>
</div>

<span id="userDisplay" style="font-size:16px; color:#555;"></span>


<div class="stats" id="statsContainer" style="opacity:0">

  <div class="status-item" onclick="openOrders('')">
    <div class="circle" style="--color:#3498db;--percent:0%">
      <span id="newCount">â€”</span>
    </div>
    <h3>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</h3>
  </div>

  <div class="status-item" onclick="openOrders('Ù…Ø«Ø¨Øª')">
    <div class="circle" style="--color:#1abc9c;--percent:0%">
      <span id="fixedCount">â€”</span>
    </div>
    <h3>Ù…Ø«Ø¨Øª</h3>
  </div>

  <div class="status-item" onclick="openOrders('Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©')">
    <div class="circle" style="--color:#9b59b6;--percent:0%">
      <span id="processingCount">â€”</span>
    </div>
    <h3>Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</h3>
  </div>

  <div class="status-item" onclick="openOrders('Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²')">
    <div class="circle" style="--color:#f39c12;--percent:0%">
      <span id="packingCount">â€”</span>
    </div>
    <h3>Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²</h3>
  </div>

  <div class="status-item" onclick="openOrders('Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø©')">
    <div class="circle" style="--color:#e67e22;--percent:0%">
      <span id="waitingCount">â€”</span>
    </div>
    <h3>Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø©</h3>
  </div>

  <div class="status-item" onclick="openOrders('Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„')">
    <div class="circle" style="--color:#2980b9;--percent:0%">
      <span id="deliveringCount">â€”</span>
    </div>
    <h3>Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„</h3>
  </div>

  <div class="status-item" onclick="openOrders('ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…')">
    <div class="circle" style="--color:#27ae60;--percent:0%">
      <span id="deliveredCount">â€”</span>
    </div>
    <h3>ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</h3>
  </div>

  <div class="status-item" onclick="openOrders('Ø±Ø§Ø¬Ø¹')">
    <div class="circle" style="--color:#c0392b;--percent:0%">
      <span id="returnedCount">â€”</span>
    </div>
    <h3>Ø±Ø§Ø¬Ø¹</h3>
  </div>

  <div class="status-item" onclick="openOrders('ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø±Ø§Ø¬Ø¹')">
    <div class="circle" style="--color:#8e44ad;--percent:0%">
      <span id="receivedReturnCount">â€”</span>
    </div>
    <h3>ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø±Ø§Ø¬Ø¹</h3>
  </div>

  <div class="status-item" onclick="openOrders('Ø±ÙØ¶')">
    <div class="circle" style="--color:#e74c3c;--percent:0%">
      <span id="rejectedCount">â€”</span>
    </div>
    <h3>Ø±ÙØ¶</h3>
  </div>

  <div class="status-item" onclick="openOrders('Ø­Ø§Ù„Ø§Øª Ø£Ø®Ø±Ù‰')">
    <div class="circle" style="--color:#7f8c8d;--percent:0%">
      <span id="otherCount">â€”</span>
    </div>
    <h3>Ø­Ø§Ù„Ø§Øª Ø£Ø®Ø±Ù‰</h3>
  </div>

  <div class="status-item" onclick="openNewOrder()">
    <div class="circle" style="--color:#34495e;--percent:0%">
      <span>ï¼‹</span>
    </div>
    <h3>Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨</h3>
  </div>

</div>


  <!-- ğŸ”¹ Ø³ÙƒØ±Ø¨Øª -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import { getDatabase, ref, get, child, set, update } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";
    

    const firebaseConfig = {
      apiKey: "AIzaSyDtEJYJrmyP45qS2da8Cuc6y6Jv5VD0Uhc",
      authDomain: "almurad-system.firebaseapp.com",
      databaseURL: "https://almurad-system-default-rtdb.firebaseio.com/",
      projectId: "almurad-system",
      storageBucket: "almurad-system.appspot.com",
      messagingSenderId: "911755824405",
      appId: "1:911755824405:web:2bfbd18ddcf038ca48ad1c"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

const user = JSON.parse(localStorage.getItem("loggedInUser"));
if (user && (user.username === "admin" || (user.roles && user.roles.includes("admin")))) {
  document.getElementById("usersMenu").style.display = "block";

 
}



    if (!user) window.location.href = "index.html";

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø©
    async function loadStats() {
      const dbRef = ref(db);
      const snapshot = await get(child(dbRef, "orders"));
      if (!snapshot.exists()) return;

      const ordersData = snapshot.val();
      const orders = Object.values(ordersData);
const mainStatuses = [
  "",
  "Ù…Ø«Ø¨Øª",
  "Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©",
  "Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²",
  "Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø©",
  "Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„",
  "ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…",
  "Ø±Ø§Ø¬Ø¹",
  "ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø±Ø§Ø¬Ø¹",
  "Ø±ÙØ¶"
];

// Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
const counts = {
  "": 0, // Ø¬Ø¯ÙŠØ¯
  "Ù…Ø«Ø¨Øª": 0,
  "Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©": 0,
  "Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²": 0,
  "Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø©": 0,
  "Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„": 0,
  "ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…": 0,
  "Ø±Ø§Ø¬Ø¹": 0,
  "ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø±Ø§Ø¬Ø¹": 0,
  "Ø±ÙØ¶": 0,
  "Ø­Ø§Ù„Ø§Øª Ø£Ø®Ø±Ù‰": 0
};
// âœ… Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¨Ø¹Ø¯ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„

orders.forEach(o => {
  let st = (o.status || "").trim();

  // ğŸŸ¦ 1) Ø§Ù„ÙØ§Ø±Øº = Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
  if (st === "") {
    counts[""]++;
    return;
  }

  // ğŸŸ© 2) Ø§Ù„Ø­Ø§Ù„Ø© Ø¶Ù…Ù† Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
  if (mainStatuses.includes(st)) {
    counts[st]++;
    return;
  }

  // ğŸŸ§ 3) Ø£ÙŠ Ø­Ø§Ù„Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© = Ø­Ø§Ù„Ø§Øª Ø£Ø®Ø±Ù‰
  counts["Ø­Ø§Ù„Ø§Øª Ø£Ø®Ø±Ù‰"]++;
});





      document.getElementById("newCount").textContent = counts[""];
      document.getElementById("fixedCount").textContent = counts["Ù…Ø«Ø¨Øª"];
      document.getElementById("processingCount").textContent = counts["Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©"];
      document.getElementById("packingCount").textContent = counts["Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²"];
      document.getElementById("deliveringCount").textContent = counts["Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„"];
      document.getElementById("deliveredCount").textContent = counts["ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…"];
      document.getElementById("returnedCount").textContent = counts["Ø±Ø§Ø¬Ø¹"];
      document.getElementById("receivedReturnCount").textContent = counts["ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø±Ø§Ø¬Ø¹"];

      document.getElementById("rejectedCount").textContent = counts["Ø±ÙØ¶"];
      document.getElementById("waitingCount").textContent = counts["Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø©"];
document.getElementById("otherCount").textContent = counts["Ø­Ø§Ù„Ø§Øª Ø£Ø®Ø±Ù‰"];
// ğŸŸ¢ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ
const total = Object.values(counts).reduce((a, b) => a + b, 0) || 1;

// ğŸ”µ Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø³Ø¨Ø©
function updateCirclePercent(spanId, value) {
  const span = document.getElementById(spanId);
  if (!span) return;
  const circle = span.closest(".circle");
  if (!circle) return;

const percent = value === 0 ? 0 : Math.max(5, Math.round((value / total) * 100));
  circle.style.setProperty("--percent", percent + "%");
}

updateCirclePercent("newCount", counts[""]);
updateCirclePercent("fixedCount", counts["Ù…Ø«Ø¨Øª"]);
updateCirclePercent("processingCount", counts["Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©"]);
updateCirclePercent("packingCount", counts["Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²"]);
updateCirclePercent("waitingCount", counts["Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø©"]);
updateCirclePercent("deliveringCount", counts["Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„"]);
updateCirclePercent("deliveredCount", counts["ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…"]);
updateCirclePercent("returnedCount", counts["Ø±Ø§Ø¬Ø¹"]);
updateCirclePercent("receivedReturnCount", counts["ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø±Ø§Ø¬Ø¹"]);
updateCirclePercent("rejectedCount", counts["Ø±ÙØ¶"]);
updateCirclePercent("otherCount", counts["Ø­Ø§Ù„Ø§Øª Ø£Ø®Ø±Ù‰"]);

// âœ… Ù‡Ù†Ø§ ÙÙ‚Ø· ØªØ¸Ù‡Ø±
document.getElementById("statsContainer").style.opacity = "1";


    }
function openOrders(status) {
  // âœ… Ø¥Ø°Ø§ Ø§Ù„Ø­Ø§Ù„Ø© ÙØ§Ø±ØºØ© (Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©) Ù†Ù…Ø±Ø± Ø¨Ø§Ø±Ø§Ù…ÙŠØªØ± ÙØ§Ø¶ÙŠ
window.location.href = `orders-cards.html?status=${encodeURIComponent(status || "")}`;
}



    function openNewOrder() {
      window.location.href = "add-order.html";
    }

function openStatistics(tab) {
  if (tab === "employees") {
    window.location.href = "stats-employees.html";
  } else if (tab === "advertisers") {
    window.location.href = "stats-advertisers.html"; // âœ… Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
  } else {
    window.location.href = `statistics.html?tab=${tab}`;
  }
}





    function toggleMenu(id) {
      const submenu = document.getElementById(id);
      submenu.style.display = submenu.style.display === "block" ? "none" : "block";
    }

    function toggleSidebar() {
      document.getElementById("sidebar").classList.toggle("active");
    }

    function logout() {
      localStorage.removeItem("loggedInUser");
      window.location.href = "index.html";
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadStats();

    });
// âœ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
const loggedUser = JSON.parse(localStorage.getItem("loggedInUser"));
if (!loggedUser) window.location.href = "index.html";

const displayName = loggedUser.name || loggedUser.username || loggedUser.user || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
document.getElementById("userDisplay").textContent = `ğŸ‘‹ Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ${displayName}`;
console.log(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${displayName}! ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­ âœ…`);


// ğŸ§© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
const roles = loggedUser.roles || [];

// ğŸ¯ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
const ordersMenu   = document.querySelector(".menu-item[onclick*='ordersMenu']");
const financeMenu  = document.querySelector(".menu-item[onclick*='financeMenu']");
const statsMenu    = document.querySelector(".menu-item[onclick*='openStatistics']");
const usersMenu    = document.getElementById("usersMenu");
const storeMenu    = document.querySelector(".menu-item[onclick*='openStore']");
const settingsMenu = document.querySelector(".menu-item[onclick*='openSettings']");

// Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙƒÙ„ Ø¨Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
if (ordersMenu) ordersMenu.style.display = "none";
if (financeMenu) financeMenu.style.display = "none";
if (statsMenu) statsMenu.style.display = "none";
if (usersMenu) usersMenu.style.display = "none";
if (storeMenu) storeMenu.style.display = "none";
if (settingsMenu) settingsMenu.style.display = "none";

// ğŸŸ¢ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…ÙØªÙˆØ­Ø© Ù„Ù„Ø¬Ù…ÙŠØ¹
if (storeMenu) storeMenu.style.display = "block";      // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²Ù†
if (settingsMenu) settingsMenu.style.display = "block"; // Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª

// ğŸŸ  Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø­Ø³Ø¨ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª

// âœ… Ø§Ù„Ø£Ø¯Ù…Ù†: ÙŠØ´ÙˆÙ ÙƒÙ„ Ø´ÙŠØ¡
if (roles.includes("admin")) {
  if (ordersMenu) ordersMenu.style.display = "block";
  if (financeMenu) financeMenu.style.display = "block";
  if (statsMenu) statsMenu.style.display = "block";
  if (usersMenu) usersMenu.style.display = "block";
  if (storeMenu) storeMenu.style.display = "block";
}

// âœ… Ø§Ù„Ù…Ø­Ø§Ø³Ø¨: Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª + Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
if (roles.includes("accountant")) {
  if (financeMenu) financeMenu.style.display = "block";
  if (statsMenu) statsMenu.style.display = "block";
}

// âœ… Ø§Ù„Ù…Ø«Ø¨Ù‘Øª: Ø§Ù„Ø·Ù„Ø¨Ø§Øª + ÙÙ‚Ø· Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª
if (roles.includes("stabilizer") && !roles.includes("admin")) {
  if (ordersMenu) ordersMenu.style.display = "block";

  // Ù†Ø¹Ø±Ø¶ ÙÙ‚Ø· Ù‚Ø³Ù… "Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª" Ø¯Ø§Ø®Ù„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
  const statsSubmenu = document.getElementById("statsMenu");
  if (statsSubmenu) {
    statsSubmenu.style.display = "block"; // Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    const items = statsSubmenu.querySelectorAll("div");
    items.forEach((el) => {
      // Ù†Ø®Ù„ÙŠ ÙÙ‚Ø· Ø£ÙˆÙ„ Ø¹Ù†ØµØ± Ø§Ù„Ù„ÙŠ Ø§Ø³Ù…Ù‡ "Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª" Ø¸Ø§Ù‡Ø±
      if (el.textContent.includes("Ø§Ù„Ø·Ù„Ø¨Ø§Øª")) el.style.display = "block";
      else el.style.display = "none";
    });
  }
}

// âœ… Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ø®Ø²Ù†
if (roles.includes("store")) {
  if (storeMenu) storeMenu.style.display = "block";
}

// âœ… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨: Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙÙ‚Ø·
if (roles.includes("delivery")) {
  if (ordersMenu) ordersMenu.style.display = "block";
}

// ğŸŸ£ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø«Ø¨Øª (stabilizer) â€“ Ø¹Ø±Ø¶ ØµÙØ­Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙ‚Ø·
if (roles.includes("stabilizer") && !roles.includes("admin")) {
  // Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø®Ø²Ù† Ù…Ø¤Ù‚ØªÙ‹Ø§
  const storeSubmenu = document.getElementById("storeMenu");
  if (storeSubmenu) {
    const items = storeSubmenu.querySelectorAll("div");
    items.forEach(el => el.style.display = "none");

    // Ø¹Ø±Ø¶ ÙÙ‚Ø· "ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª"
    const detailsItem = Array.from(items).find(el => el.textContent.includes("ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª"));
    if (detailsItem) detailsItem.style.display = "block";
  }
}


    window.toggleMenu = toggleMenu;
    window.toggleSidebar = toggleSidebar;
    window.openOrders = openOrders;
    window.openNewOrder = openNewOrder;
    window.openStatistics = openStatistics;
    window.logout = logout;
    function openUsers() {
  window.location.href = "users.html";
}
window.openUsers = function() {// ğŸ‘‹ Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø³Ù…
const loggedUser = JSON.parse(localStorage.getItem("loggedInUser"));
if (loggedUser && loggedUser.user) {
  document.getElementById("userDisplay").textContent = `ğŸ‘‹ Ø£Ù‡Ù„Ø§Ù‹ ${loggedUser.user}!`;
}
  window.location.href = "users.html";
};


// âš¡ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø¨Ø§Ø±Ø§Øª Ø§Ù„ØªØ­ÙÙŠØ²ÙŠØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (Ø¨Ø¯ÙˆÙ† Ù…ÙƒØªØ¨Ø© Ø®Ø§Ø±Ø¬ÙŠØ©)
function loadMotivationalQuote() {
  const quotes = [
    "Ø§Ø¨Ø¯Ø£ ÙŠÙˆÙ…Ùƒ Ø¨Ø¥ÙŠÙ…Ø§Ù†Ùƒ Ø¨Ù†ÙØ³ÙƒØŒ ÙÙƒÙ„ Ø®Ø·ÙˆØ© ØµØºÙŠØ±Ø© Ù†Ø­Ùˆ Ù‡Ø¯ÙÙƒ ØªÙ‚Ø±Ø¨Ùƒ Ù…Ù† Ø§Ù„Ù†Ø¬Ø§Ø­ Ø§Ù„ÙƒØ¨ÙŠØ±.",
    "Ø­ÙŠÙ† ØªØ¸Ù† Ø£Ù† Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø§Ù†ØªÙ‡Ù‰ØŒ ØªØ°ÙƒÙ‘Ø± Ø£Ù† Ø§Ù„Ù†Ø§Ø¬Ø­ÙŠÙ† ØµÙ†Ø¹ÙˆØ§ Ø·Ø±ÙŠÙ‚Ù‡Ù… Ø¹Ù†Ø¯Ù…Ø§ Ù„Ù… ÙŠØ¬Ø¯ÙˆØ§ Ø·Ø±ÙŠÙ‚Ù‹Ø§ Ø£ØµÙ„Ù‹Ø§.",
    "Ù„Ø§ ØªÙ†ØªØ¸Ø± Ø§Ù„Ø¸Ø±ÙˆÙ Ù„ØªØªØ­Ø³Ù†ØŒ Ø¨Ù„ ÙƒÙ† Ø£Ù†Øª Ø§Ù„Ø³Ø¨Ø¨ ÙÙŠ ØªØ­Ø³ÙŠÙ†Ù‡Ø§. ÙØ§Ù„ÙØ±Øµ ØªÙØ®Ù„Ù‚ Ù„Ø§ ØªÙÙ†ØªØ¸Ø±.",
    "Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¬Ø§Ø¯ Ø§Ù„ÙŠÙˆÙ… Ù‡Ùˆ Ù…Ø§ ÙŠØ¬Ø¹Ù„ ØºØ¯Ùƒ Ù…Ø®ØªÙ„ÙÙ‹Ø§ Ø¹Ù† Ø§Ù„Ø¨Ù‚ÙŠØ©. Ø§Ø¬Ø¹Ù„ ÙƒÙ„ ÙŠÙˆÙ… Ø®Ø·ÙˆØ© Ù†Ø­Ùˆ Ø£Ø­Ù„Ø§Ù…Ùƒ.",
    "Ø§Ù„Ù†Ø¬Ø§Ø­ Ù„Ø§ ÙŠÙÙ‚Ø§Ø³ Ø¨Ù…Ø§ ÙˆØµÙ„Øª Ø¥Ù„ÙŠÙ‡ØŒ Ø¨Ù„ Ø¨Ù…Ø§ ØªØºÙ„Ø¨Øª Ø¹Ù„ÙŠÙ‡ Ù„ØªØµÙ„ Ø¥Ù„Ù‰ Ù‡Ù†Ø§Ùƒ.",
    "Ù„Ø§ ØªØ®Ù Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ§Øª Ø§Ù„ØµØºÙŠØ±Ø©ØŒ ÙÙƒÙ„ Ø¥Ù†Ø¬Ø§Ø² Ø¹Ø¸ÙŠÙ… Ø¨Ø¯Ø£ Ø¨Ø®Ø·ÙˆØ© Ù…ØªÙˆØ§Ø¶Ø¹Ø© ÙˆØ´ØºÙ Ù„Ø§ ÙŠÙ†Ø·ÙØ¦.",
    "Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ù„Ø§ ÙŠØ­ØªØ§Ø¬ Ù…Ø¹Ø¬Ø²Ø©ØŒ ÙÙ‚Ø· Ù‚Ù„Ø¨ Ù„Ø§ ÙŠØ¹Ø±Ù Ø§Ù„Ø§Ø³ØªØ³Ù„Ø§Ù… ÙˆØ¹Ù‚Ù„ ÙŠØ¤Ù…Ù† Ø¨Ø§Ù„Ø­Ù„ÙˆÙ„.",
    "Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ù„ÙŠØ³Øª Ø¹ÙˆØ§Ø¦Ù‚ØŒ Ø¨Ù„ ÙØ±Øµ Ù„ØªÙØ¸Ù‡Ø± Ù‚ÙˆØªÙƒ ÙˆÙ‚Ø¯Ø±ØªÙƒ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ…ÙŠØ².",
    "ÙƒÙ† Ù…Ø«Ù„ Ø§Ù„Ù†Ø®Ù„Ø©ØŒ ØªÙØ±Ù…Ù‰ Ø¨Ø§Ù„Ø­Ø¬Ø§Ø±Ø© ÙØªØ¹Ø·ÙŠ Ø£Ø·ÙŠØ¨ Ø§Ù„Ø«Ù…Ø§Ø±. Ø§Ø¬Ø¹Ù„ ØµØ¹ÙˆØ¨Ø§ØªÙƒ Ø¯Ø§ÙØ¹Ù‹Ø§ Ù„Ø§ Ø­Ø§Ø¬Ø²Ù‹Ø§.",
    "Ù…Ø§ ØªØ²Ø±Ø¹Ù‡ Ù…Ù† Ø¬Ù‡Ø¯ Ø§Ù„ÙŠÙˆÙ…ØŒ Ø³ØªØ­ØµØ¯Ù‡ ØºØ¯Ù‹Ø§ Ù†Ø¬Ø§Ø­Ù‹Ø§ ÙŠÙ…Ù„Ø£ Ø­ÙŠØ§ØªÙƒ ÙØ®Ø±Ù‹Ø§ ÙˆØ³Ø¹Ø§Ø¯Ø©.",
    "Ù„Ø§ ØªØ³ØªÙ‡ÙŠÙ† Ø¨Ø£ÙŠ Ø¥Ù†Ø¬Ø§Ø²ØŒ ÙÙƒÙ„ Ø®Ø·ÙˆØ© Ù†Ø­Ùˆ Ø§Ù„Ø£ÙØ¶Ù„ Ù‡ÙŠ Ù†ØµØ±ÙŒ Ø¹Ù„Ù‰ Ø§Ù„ØªØ±Ø¯Ø¯ ÙˆØ§Ù„ÙƒØ³Ù„.",
    "ÙƒÙ„ ØµØ¨Ø§Ø­ Ù‡Ùˆ ÙØ±ØµØ© Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªØ«Ø¨Øª Ø£Ù†Ùƒ Ù‚Ø§Ø¯Ø± Ø¹Ù„Ù‰ Ø£Ù† ØªÙƒÙˆÙ† Ø£ÙØ¶Ù„ Ù…Ù† Ø§Ù„Ø£Ù…Ø³.",
    "Ø§Ù„Ø«Ù‚Ø© Ø¨Ø§Ù„Ù†ÙØ³ Ù„Ø§ ØªØ¹Ù†ÙŠ Ø£Ù†Ùƒ Ø§Ù„Ø£ÙØ¶Ù„ØŒ Ø¨Ù„ Ø£Ù†Ùƒ Ù„Ø§ ØªÙ‚Ø§Ø±Ù† Ù†ÙØ³Ùƒ Ø¨Ø£Ø­Ø¯.",
    "Ø§Ù„Ø·Ù…ÙˆØ­ Ù‡Ùˆ Ø§Ù„ÙˆÙ‚ÙˆØ¯ Ø§Ù„Ø°ÙŠ ÙŠØ¬Ø¹Ù„ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„ØµØ¹Ø¨Ø© Ù…Ø¬Ø±Ø¯ Ù…Ø±Ø§Ø­Ù„ ÙÙŠ Ø·Ø±ÙŠÙ‚ Ø§Ù„Ù†Ø¬Ø§Ø­.",
    "Ù„Ø§ ØªÙ†Ø¸Ø± Ù„Ù„Ù‚Ù…Ù… Ù…Ù† Ø¨Ø¹ÙŠØ¯ØŒ Ø§ØµØ¹Ø¯ Ø¨Ø®Ø·ÙˆØ§Øª Ø«Ø§Ø¨ØªØ©ØŒ ÙˆØ³ØªØµÙ„ Ø¹Ø§Ø¬Ù„Ø§Ù‹ Ø£Ù… Ø¢Ø¬Ù„Ø§Ù‹.",
    "Ø§Ù„ÙØ´Ù„ Ù„ÙŠØ³ Ø¹Ø¯ÙˆÙƒØŒ Ø¨Ù„ Ù…Ø¹Ù„Ù…Ùƒ Ø§Ù„Ø°ÙŠ ÙŠØ¯ÙØ¹Ùƒ Ù„ØªØªØ¹Ù„Ù… ÙƒÙŠÙ ØªØµÙ„ Ø¨Ø´ÙƒÙ„Ù Ø£Ù‚ÙˆÙ‰."
  ];

  // ğŸ§  Ø§Ø®ØªÙŠØ§Ø± Ø­ÙƒÙ…Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
  const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];

  // ğŸ’¾ Ø­ÙØ¸ Ø¢Ø®Ø± Ø­ÙƒÙ…Ø© Ù„Ø¹Ø¯Ù… ØªÙƒØ±Ø§Ø±Ù‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©
  localStorage.setItem("lastQuote", randomQuote);

  // ğŸ¨ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ
  const quoteBox = document.createElement("div");
  quoteBox.innerHTML = `<strong>ğŸ’¬ ${randomQuote}</strong>`;
  quoteBox.id = "quoteBox";
  quoteBox.style.background = "#FF6B2D";
  quoteBox.style.color = "white";
  quoteBox.style.padding = "16px";
  quoteBox.style.margin = "18px 0";
  quoteBox.style.borderRadius = "10px";
  quoteBox.style.textAlign = "center";
  quoteBox.style.fontWeight = "bold";
  quoteBox.style.fontSize = "16px";
  quoteBox.style.lineHeight = "1.8";
  quoteBox.style.direction = "rtl";
  quoteBox.style.boxShadow = "0 3px 10px rgba(0,0,0,0.15)";
  quoteBox.style.animation = "fadeIn 1.5s ease";
  quoteBox.style.transition = "transform 0.8s ease";
  quoteBox.style.transform = "translateY(10px)";
  setTimeout(() => (quoteBox.style.transform = "translateY(0)"), 100);

  const header = document.getElementById("userDisplay");
  if (header) {
    const old = document.getElementById("quoteBox");
    if (old) old.remove();
    header.after(quoteBox);
  }
}
// ğŸš€ ØªÙ†ÙÙŠØ° ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
loadMotivationalQuote();

// âœ… ÙØªØ­ ØµÙØ­Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù† Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…
function openStore(tab) {
  if (tab === "purchases") {
    window.location.href = "purchases.html"; // ØµÙØ­Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª
  } else if (tab === "daily") {
    window.location.href = "daily-inventory.html"; // âœ… ØµÙØ­Ø© Ø§Ù„Ø¬Ø±Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
  } else if (tab === "losses") {
    window.location.href = "losses.html"; // ØµÙØ­Ø© Ø§Ù„ØªØ§Ù„Ù ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø±
  } else if (tab === "summary") {
    window.location.href = "inventory-summary.html"; // ØµÙØ­Ø© Ø§Ù„Ø¬Ø±Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ
  }
}
window.openStore = openStore;

// ğŸ”¹ Ø¯Ø§Ù„Ø© Ø§Ù„ØªØµÙÙŠØ± Ø§Ù„Ø°ÙƒÙŠ
async function monthlySmartReset() {
  const dbRef = ref(db);
  const monthKey = new Date().toISOString().slice(0,7); // Ù…Ø«Ø§Ù„: 2025-11
  const confirmReset = confirm("âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØµÙÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ù‡Ø±ØŸ Ø³ÙŠØªÙ… Ø£Ø±Ø´ÙØ© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© ÙˆØ§Ù„ÙÙˆØ§ØªÙŠØ± ÙˆØ§Ù„Ø­Ø³Ø§Ø¨Ø§Øª.");

  if (!confirmReset) return;

  try {
    // ğŸŸ  Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
    const ordersSnap = await get(child(dbRef, "orders"));
    if (ordersSnap.exists()) {
      const allOrders = ordersSnap.val();
      const keepStatuses = ["Ù…Ø«Ø¨Øª", "Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©", "Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²", "Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„", "Ø±Ø§Ø¬Ø¹"];
      const archiveStatuses = ["ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…", "ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø±Ø§Ø¬Ø¹", "Ø±ÙØ¶"];

      const newOrders = {};
      const archiveOrders = {};

      for (const [id, o] of Object.entries(allOrders)) {
        if (archiveStatuses.includes(o.status)) archiveOrders[id] = o;
        else if (keepStatuses.includes(o.status)) newOrders[id] = o;
      }

      await set(ref(db, `archive/${monthKey}/orders`), archiveOrders);
      await set(ref(db, "orders"), newOrders);
    }

    // ğŸŸ¢ Ø§Ù„ÙÙˆØ§ØªÙŠØ± ÙˆØ§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
    const invoicesSnap = await get(child(dbRef, "invoices"));
    const accountsSnap = await get(child(dbRef, "accounts"));
    const invoices = invoicesSnap.exists() ? invoicesSnap.val() : {};
    const accounts = accountsSnap.exists() ? accountsSnap.val() : {};

    await set(ref(db, `archive/${monthKey}/invoices`), invoices);
    await set(ref(db, `archive/${monthKey}/accounts`), accounts);

    await set(ref(db, "invoices"), {});
    await set(ref(db, "accounts"), {});

    // ğŸŸ£ ØªÙ†Ø¸ÙŠÙ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø¨Ø§Ù„Ù…Ø®Ø²Ù†
    const warehouseSnap = await get(child(dbRef, "warehouse"));
    if (warehouseSnap.exists()) {
      const warehouse = warehouseSnap.val();
      for (const name in warehouse) {
        warehouse[name].processedOrders = {};
      }
      await update(ref(db, "warehouse"), warehouse);
    }

    alert("âœ… ØªÙ… ØªØµÙÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ù‡Ø± ÙˆØ£Ø±Ø´ÙØªÙ‡Ø§ Ø¨Ù†Ø¬Ø§Ø­!");
  } catch (err) {
    console.error("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØµÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", err);
    alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØµÙÙŠØ±. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.");
  }
}
// ğŸ”’ Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„ØºÙŠØ± Ø§Ù„Ø£Ø¯Ù…Ù†
const archiveMenu = document.querySelector(".menu-item[onclick*='openArchive']");
if (archiveMenu && (!roles.includes("admin"))) {
  archiveMenu.style.display = "none";
}

// ğŸ—‚ï¸ ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø´Ù‡Ø±ÙŠ
function openArchive() {
  window.location.href = "monthly-archive.html";
}
window.openArchive = openArchive;

  </script>
<!-- âœ… Ù†Ø¸Ø§Ù… Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ù†ÙØ³ ÙƒÙˆØ¯ ØµÙØ­Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª) -->
<script>
function enableSoundOnce() {
  try {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const source = ctx.createBufferSource();
    source.connect(ctx.destination);
  } catch (e) {
    console.warn("âš ï¸ Ù„Ù… ÙŠØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª:", e);
  }

  window.soundAllowed = true;
  console.log("ğŸ”Š ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¨Ù†Ø¬Ø§Ø­");
  
  // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ø¨Ø¹Ø¯ Ø§Ù„ØªÙØ¹ÙŠÙ„
  document.removeEventListener("touchstart", enableSoundOnce);
  document.removeEventListener("click", enableSoundOnce);
}
document.addEventListener("touchstart", enableSoundOnce, { once: true });
document.addEventListener("click", enableSoundOnce, { once: true });

  // âœ… Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± ÙˆØ§Ù„ØµÙˆØª (Ù†ÙØ³ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ Ø¨ØµÙØ­Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª)
  function showNewOrderNotification(count = 1) {
    const oldBar = document.getElementById("newOrderBar");
    if (oldBar) oldBar.remove();

    const bar = document.createElement("div");
    bar.id = "newOrderBar";
    bar.innerHTML = `
      <div style="display:flex;align-items:center;gap:12px;animation:fadeInUp 0.4s ease">
        <span style="font-size:28px;background:#fff;color:#28a745;border-radius:50%;
        width:46px;height:46px;display:flex;align-items:center;justify-content:center;
        box-shadow:0 0 10px rgba(255,255,255,0.3)">ğŸ’µ</span>
        <div>
          <div style="font-weight:bold;font-size:16px;">ÙˆØµÙ„ ${count} Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯${count>1?"Ø§Øª":""}!</div>
          <div style="font-size:13px;opacity:0.9;">ØªØ­Ù‚Ù‚ Ø§Ù„Ø¢Ù† Ù…Ù† Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
        </div>
      </div>
    `;
    Object.assign(bar.style, {
      position: "fixed",
      bottom: "25px",
      right: "25px",
      background: "linear-gradient(135deg,#28a745,#20c997)",
      color: "white",
      padding: "14px 22px",
      borderRadius: "16px",
      fontFamily: "Tajawal, sans-serif",
      boxShadow: "0 8px 25px rgba(0,0,0,0.3)",
      zIndex: "999999",
      cursor: "pointer",
      opacity: "1",
      transition: "all 0.6s ease"
    });
    document.body.appendChild(bar);

    if (window.soundAllowed) {
const audio = new Audio("cash-register-kaching.mp3");
      audio.volume = 1.0;
      audio.play().catch(err => console.warn("ğŸ”‡ ÙØ´Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª:", err));
    }

    bar.addEventListener("mouseenter",()=>bar.style.transform="scale(1.05)");
    bar.addEventListener("mouseleave",()=>bar.style.transform="scale(1)");

    setTimeout(()=>{
      bar.style.opacity="0";
      bar.style.transform="translateY(20px)";
      setTimeout(()=>bar.remove(),600);
    },6000);

    const style=document.createElement("style");
    style.textContent=`
      @keyframes fadeInUp {
        from {opacity:0;transform:translateY(40px);}
        to {opacity:1;transform:translateY(0);}
      }`;
    document.head.appendChild(style);
  }

  // âœ… Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù…Ø«Ù„ ØµÙØ­Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª ØªÙ…Ø§Ù…Ø§Ù‹
  import("https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js").then(async ({ initializeApp }) => {
    const { getDatabase, ref, onValue } = await import("https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js");
    const app = initializeApp({
      apiKey: "AIzaSyDtEJYJrmyP45qS2da8Cuc6y6Jv5VD0Uhc",
      authDomain: "almurad-system.firebaseapp.com",
      databaseURL: "https://almurad-system-default-rtdb.firebaseio.com/",
      projectId: "almurad-system",
      storageBucket: "almurad-system.appspot.com",
      messagingSenderId: "911755824405",
      appId: "1:911755824405:web:2bfbd18ddcf038ca48ad1c"
    });

    const db = getDatabase(app);
    const ordersRef = ref(db, "orders");
    let previousCount = 0;

    onValue(ordersRef, (snapshot) => {
      if (!snapshot.exists()) return;
      const data = snapshot.val();
      const count = Object.keys(data).length;
      if (previousCount && count > previousCount) {
        const diff = count - previousCount;
        showNewOrderNotification(diff);
      }
      previousCount = count;
    });
  });


</script>
</body>
</html>
