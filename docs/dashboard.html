<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ููุญุฉ ุงูุชุญูู - ูุธุงู ุงููุฑุงุฏ</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
   body {
  margin: 0;
  font-family: 'Tajawal', sans-serif;
  display: flex;
  height: 100vh;
  background: linear-gradient(180deg, #f8f9fb 0%, #eef2f7 100%);
  overflow: hidden;
  color: #043B64;
}


    /* ุงูุดุฑูุท ุงูุฌุงูุจู */
    .sidebar {
      width: 260px;
      background-color: #043B64;
      color: white;
      display: flex;
      flex-direction: column;
      transition: transform 0.3s ease;
      z-index: 1000;
    }

    .sidebar h2 {
      text-align: center;
      background-color: #FF6B2D;
      padding: 15px;
      margin: 0;
      font-size: 18px;
    }

    .menu-item {
      padding: 15px 20px;
      cursor: pointer;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .menu-item:hover {
      background-color: rgba(255,255,255,0.1);
    }

    .submenu {
      background-color: #064b7a;
      display: none;
    }

    .submenu div {
      padding: 10px 40px;
      font-size: 14px;
      cursor: pointer;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .submenu div:hover {
      background-color: rgba(255,255,255,0.15);
    }

    /* ุงููุญุชูู */
    .content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      position: relative;
    }

    .header {
      font-size: 22px;
      color: #043B64;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .menu-toggle {
      display: none;
      font-size: 24px;
      background: none;
      border: none;
      color: #043B64;
      cursor: pointer;
    }
/* ๐ข ุชุตููู ุงููุฑูุช ุงูุงุญุชุฑุงูู */
.stats {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
  gap: 20px;
  margin-top: 10px;
}

.card {
  position: relative;
  background: linear-gradient(145deg, #ffffff, #f4f6fa);
  border-radius: 15px;
  padding: 20px;
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.05);
  text-align: center;
  cursor: pointer;
  transition: all 0.25s ease;
  overflow: hidden;
}

.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.card h3 {
  color: #043B64;
  margin: 0;
  font-size: 16px;
  font-weight: 700;
}

.card p {
  margin: 12px 0 0;
  font-size: 20px;
  font-weight: bold;
  color: #FF6B2D;
  transition: color 0.3s;
}

/* ๐จ ุฃููุงู ุงูุญุงูุงุช */
.card[data-status=""] h3 { color: #3498db; }            /* ุฌุฏูุฏ */
.card[data-status="ูุซุจุช"] h3 { color: #1abc9c; }        /* ูุซุจุช */
.card[data-status="ููุฏ ุงููุนุงูุฌุฉ"] h3 { color: #e67e22; }
.card[data-status="ููุฏ ุงูุชุฌููุฒ"] h3 { color: #f39c12; }
.card[data-status="ููุฏ ุงูุชูุตูู"] h3 { color: #f1c40f; }
.card[data-status="ุชู ุงูุชุณููู"] h3 { color: #2ecc71; }
.card[data-status="ุฑุงุฌุน"] h3 { color: #e74c3c; }
.card[data-status="ุชู ุงุณุชูุงู ุงูุฑุงุฌุน"] h3 { color: #c0392b; }
.card[data-status="ุฑูุถ"] h3 { color: #7f8c8d; }
.card[data-status="ุจุงูุชุธุงุฑ ุงูุจุถุงุนุฉ"] h3 { color: #9b59b6; }

/* ๐ธ ุชุฃุซูุฑ ูููุฒ ุนูุฏ ุงููุฑูุฑ */
.card::after {
  content: "";
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: linear-gradient(135deg, rgba(255,107,45,0.15), rgba(4,59,100,0.15));
  opacity: 0;
  transition: opacity 0.3s ease;
  border-radius: 15px;
  z-index: 0;
}

.card:hover::after {
  opacity: 1;
}

.card > * {
  position: relative;
  z-index: 1;
}


    .logout {
      background: #FF6B2D;
      border: none;
      padding: 10px;
      color: white;
      border-radius: 6px;
      margin: 15px;
      cursor: pointer;
    }

    .logout:hover {
      opacity: 0.9;
    }

    @media (max-width: 768px) {
  .sidebar {
    position: fixed;
    top: 0;
    bottom: 0;
    right: 0;
    transform: translateX(100%);
  }

  .sidebar.active {
    transform: translateX(0);
  }

  .menu-toggle {
    display: block;
  }
}

/* โ ุงูููุฏ ุงูุฌุฏูุฏ ููุง */
h1, h2, h3, h4, h5, h6 {
  font-weight: 700;
}

p, div, span, button {
  font-weight: 500;
}

</style>

</head>
<body>

  <!-- ุงูุดุฑูุท ุงูุฌุงูุจู -->
  <div class="sidebar" id="sidebar">
    <h2>ูุธุงู ุงููุฑุงุฏ โ๏ธ</h2>

    <!-- ๐ฃ ุงูุทูุจุงุช -->
    <div class="menu-item" onclick="toggleMenu('ordersMenu')">๐ฆ ุงูุทูุจุงุช</div>
    <div class="submenu" id="ordersMenu">
      <div onclick="openOrders('')">ุงูุทูุจุงุช ุงูุฌุฏูุฏุฉ</div>
      <div onclick="openOrders('ูุซุจุช')">ุงูุทูุจุงุช ุงููุซุจุชุฉ</div>
      <div onclick="openOrders('ููุฏ ุงููุนุงูุฌุฉ')">ููุฏ ุงููุนุงูุฌุฉ</div>
      <div onclick="openOrders('ููุฏ ุงูุชุฌููุฒ')">ููุฏ ุงูุชุฌููุฒ</div>
      <div onclick="openOrders('ููุฏ ุงูุชูุตูู')">ููุฏ ุงูุชูุตูู</div>
      <div onclick="openOrders('ุชู ุงูุชุณููู')">ุชู ุงูุชุณููู</div>
      <div onclick="openOrders('ุฑุงุฌุน')">ุงูุทูุจุงุช ุงูุฑุงุฌุนุฉ</div>
      <div onclick="openOrders('ุฑูุถ')">ุงูุทูุจุงุช ุงููุฑููุถุฉ</div>
      <div onclick="openOrders('ุจุงูุชุธุงุฑ ุงูุจุถุงุนุฉ')">ุจุงูุชุธุงุฑ ุงูุจุถุงุนุฉ</div>
      <div onclick="openOrders('ุญุงูุงุช ุฃุฎุฑู')">ุญุงูุงุช ุฃุฎุฑู</div>


      <div style="background:#FF6B2D;color:white;font-weight:bold;text-align:center;cursor:pointer" onclick="openNewOrder()">โ ุฅุถุงูุฉ ุทูุจ ุฌุฏูุฏ</div>
    </div>

    <!-- ๐ฐ ุงูุญุณุงุจุงุช -->
<div class="menu-item" onclick="toggleMenu('financeMenu')">๐ฐ ุงูุญุณุงุจุงุช</div>
<div class="submenu" id="financeMenu">
  <div onclick="openFinance('sales')">ุงููุจูุนุงุช</div>
  <div onclick="openFinance('expenses')">ุงููุตุฑููุงุช</div>
  <div onclick="openFinance('profits')">ุงูุฃุฑุจุงุญ ูุงูุฎุณุงุฆุฑ</div>
  <div onclick="openFinance('suppliers')">ุงูููุฑุฏูู</div>
  <div onclick="openFinance('balances')">ุงูุฃุฑุตุฏุฉ</div>
</div>

<!-- ๐ฌ ุงููุฎุฒู -->
<div class="menu-item" onclick="toggleMenu('storeMenu')">๐ฌ ุงููุฎุฒู</div>
<div class="submenu" id="storeMenu">
<div onclick="window.location.href='warehouse.html'">๐ฌ ุฅุฏุงุฑุฉ ุงููุฎุฒูู</div>
<div onclick="window.location.href='warehouse-details.html'">๐ ุชูุงุตูู ุงูููุชุฌุงุช</div>
  <div onclick="openStore('purchases')">ุงููุดุชุฑูุงุช</div>
  <div onclick="openStore('daily')">๐ ุงูุฌุฑุฏ ุงููููู</div>
  <div onclick="openStore('losses')">ุงูุชุงูู ูุงูุฎุณุงุฆุฑ</div>
  <div onclick="openStore('summary')">ุงูุฌุฑุฏ ุงูุดูุฑู</div>
</div>

    <!-- ๐ ุงูุฅุญุตุงุฆูุงุช -->
<!-- ๐ ุงูุฅุญุตุงุฆูุงุช -->
<div class="menu-item" onclick="toggleMenu('statsMenu')">๐ ุงูุฅุญุตุงุฆูุงุช</div>
<div class="submenu" id="statsMenu">
  <div onclick="openStatistics('orders')">ุฅุญุตุงุฆูุงุช ุงูุทูุจุงุช</div>
  <div onclick="openStatistics('employees')">ุฅุญุตุงุฆูุงุช ุงูููุธููู</div>
  <div onclick="openStatistics('products')">ุฅุญุตุงุฆูุงุช ุงูููุชุฌุงุช</div>
  <div onclick="openStatistics('advertisers')">ุฅุญุตุงุฆูุงุช ุงููุนูููู</div>
  <div onclick="openStatistics('daily')">ุงูุฅุญุตุงุฆูุงุช ุงูููููุฉ</div>
</div>

<!-- ๐๏ธ ุงูุฃุฑุดูู ุงูุดูุฑู -->
<div class="menu-item" onclick="openArchive()">๐๏ธ ุงูุฃุฑุดูู ุงูุดูุฑู</div>

    <!-- ๐ฅ ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู (ุชุธูุฑ ููุท ููุฃุฏูู) -->
<div class="menu-item" id="usersMenu" style="display:none;" onclick="openUsers()">๐ฅ ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู</div>


    <!-- ๐ช ุชุณุฌูู ุงูุฎุฑูุฌ -->
    <button class="logout" onclick="logout()">๐ช ุชุณุฌูู ุงูุฎุฑูุฌ</button>
  </div>

  <!-- ุงููุญุชูู -->
  <div class="content">
<div class="header">


  <span id="sectionTitle">ููุญุฉ ุงูุชุญูู ุงูุฑุฆูุณูุฉ</span>
  <button class="menu-toggle" onclick="toggleSidebar()">โฐ</button>
</div>

<span id="userDisplay" style="font-size:16px; color:#555;"></span>


    <div class="stats" id="statsContainer">
      <div class="card" data-status=""><h3>ุงูุทูุจุงุช ุงูุฌุฏูุฏุฉ</h3><p id="newCount">0</p></div>
      <div class="card" data-status="ูุซุจุช"><h3>ุงูุทูุจุงุช ุงููุซุจุชุฉ</h3><p id="fixedCount">0</p></div>
      <div class="card" data-status="ููุฏ ุงููุนุงูุฌุฉ"><h3>ููุฏ ุงููุนุงูุฌุฉ</h3><p id="processingCount">0</p></div>
      <div class="card" data-status="ููุฏ ุงูุชุฌููุฒ"><h3>ููุฏ ุงูุชุฌููุฒ</h3><p id="packingCount">0</p></div>
      <div class="card" data-status="ููุฏ ุงูุชูุตูู"><h3>ููุฏ ุงูุชูุตูู</h3><p id="deliveringCount">0</p></div>
      <div class="card" data-status="ุชู ุงูุชุณููู"><h3>ุชู ุงูุชุณููู</h3><p id="deliveredCount">0</p></div>
      <div class="card" data-status="ุฑุงุฌุน"><h3>ุฑุงุฌุน</h3><p id="returnedCount">0</p></div>
      <div class="card" data-status="ุชู ุงุณุชูุงู ุงูุฑุงุฌุน">
  <h3>ุชู ุงุณุชูุงู ุงูุฑุงุฌุน</h3>
  <p id="receivedReturnCount">0</p>
</div>

      <div class="card" data-status="ุฑูุถ"><h3>ุฑูุถ</h3><p id="rejectedCount">0</p></div>
    
      <div class="card" data-status="ุจุงูุชุธุงุฑ ุงูุจุถุงุนุฉ">
  <h3>ุจุงูุชุธุงุฑ ุงูุจุถุงุนุฉ</h3>
  <p id="waitingCount">0</p>
</div>
<div class="card" data-status="ุญุงูุงุช ุฃุฎุฑู">
  <h3>ุญุงูุงุช ุฃุฎุฑู</h3>
  <p id="otherCount">0</p>
</div>

      <!-- ๐ ุฅุถุงูุฉ ุทูุจ ุฌุฏูุฏ -->
      <div class="card" id="card-add" style="background:#FF6B2D;color:white;">
        <h3>โ ุฅุถุงูุฉ ุทูุจ ุฌุฏูุฏ</h3>
        <p>ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ</p>
      </div>
    </div>
  </div>
  

  <!-- ๐น ุณูุฑุจุช -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import { getDatabase, ref, get, child, set, update } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";
    

    const firebaseConfig = {
      apiKey: "AIzaSyDtEJYJrmyP45qS2da8Cuc6y6Jv5VD0Uhc",
      authDomain: "almurad-system.firebaseapp.com",
      databaseURL: "https://almurad-system-default-rtdb.firebaseio.com/",
      projectId: "almurad-system",
      storageBucket: "almurad-system.appspot.com",
      messagingSenderId: "911755824405",
      appId: "1:911755824405:web:2bfbd18ddcf038ca48ad1c"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

const user = JSON.parse(localStorage.getItem("loggedInUser"));
if (user && (user.username === "admin" || (user.roles && user.roles.includes("admin")))) {
  document.getElementById("usersMenu").style.display = "block";

 
}



    if (!user) window.location.href = "index.html";

    // ุชุญููู ุงูุฅุญุตุงุฆูุงุช ุงูุณุฑูุนุฉ
    async function loadStats() {
      const dbRef = ref(db);
      const snapshot = await get(child(dbRef, "orders"));
      if (!snapshot.exists()) return;

      const ordersData = snapshot.val();
      const orders = Object.values(ordersData);
const mainStatuses = [
  "",
  "ูุซุจุช",
  "ููุฏ ุงููุนุงูุฌุฉ",
  "ููุฏ ุงูุชุฌููุฒ",
  "ุจุงูุชุธุงุฑ ุงูุจุถุงุนุฉ",
  "ููุฏ ุงูุชูุตูู",
  "ุชู ุงูุชุณููู",
  "ุฑุงุฌุน",
  "ุชู ุงุณุชูุงู ุงูุฑุงุฌุน",
  "ุฑูุถ"
];

// ุงูุฅุญุตุงุฆูุงุช
const counts = {
  "": 0, // ุฌุฏูุฏ
  "ูุซุจุช": 0,
  "ููุฏ ุงููุนุงูุฌุฉ": 0,
  "ููุฏ ุงูุชุฌููุฒ": 0,
  "ุจุงูุชุธุงุฑ ุงูุจุถุงุนุฉ": 0,
  "ููุฏ ุงูุชูุตูู": 0,
  "ุชู ุงูุชุณููู": 0,
  "ุฑุงุฌุน": 0,
  "ุชู ุงุณุชูุงู ุงูุฑุงุฌุน": 0,
  "ุฑูุถ": 0,
  "ุญุงูุงุช ุฃุฎุฑู": 0
};

orders.forEach(o => {
  let st = (o.status || "").trim();

  // ๐ฆ 1) ุงููุงุฑุบ = ุทูุจ ุฌุฏูุฏ
  if (st === "") {
    counts[""]++;
    return;
  }

  // ๐ฉ 2) ุงูุญุงูุฉ ุถูู ุงูุญุงูุงุช ุงูุฑุฆูุณูุฉ
  if (mainStatuses.includes(st)) {
    counts[st]++;
    return;
  }

  // ๐ง 3) ุฃู ุญุงูุฉ ุบูุฑ ููุฌูุฏุฉ = ุญุงูุงุช ุฃุฎุฑู
  counts["ุญุงูุงุช ุฃุฎุฑู"]++;
});





      document.getElementById("newCount").textContent = counts[""];
      document.getElementById("fixedCount").textContent = counts["ูุซุจุช"];
      document.getElementById("processingCount").textContent = counts["ููุฏ ุงููุนุงูุฌุฉ"];
      document.getElementById("packingCount").textContent = counts["ููุฏ ุงูุชุฌููุฒ"];
      document.getElementById("deliveringCount").textContent = counts["ููุฏ ุงูุชูุตูู"];
      document.getElementById("deliveredCount").textContent = counts["ุชู ุงูุชุณููู"];
      document.getElementById("returnedCount").textContent = counts["ุฑุงุฌุน"];
      document.getElementById("receivedReturnCount").textContent = counts["ุชู ุงุณุชูุงู ุงูุฑุงุฌุน"];

      document.getElementById("rejectedCount").textContent = counts["ุฑูุถ"];
      document.getElementById("waitingCount").textContent = counts["ุจุงูุชุธุงุฑ ุงูุจุถุงุนุฉ"];
document.getElementById("otherCount").textContent = counts["ุญุงูุงุช ุฃุฎุฑู"];

    }
function openOrders(status) {
  // โ ุฅุฐุง ุงูุญุงูุฉ ูุงุฑุบุฉ (ุทูุจุงุช ุฌุฏูุฏุฉ) ููุฑุฑ ุจุงุฑุงููุชุฑ ูุงุถู
window.location.href = `orders-cards.html?status=${encodeURIComponent(status || "")}`;
}



    function openNewOrder() {
      window.location.href = "add-order.html";
    }

function openStatistics(tab) {
  if (tab === "employees") {
    window.location.href = "stats-employees.html";
  } else if (tab === "advertisers") {
    window.location.href = "stats-advertisers.html"; // โ ูุฐู ุงูุตูุญุฉ ุงูุฌุฏูุฏุฉ
  } else {
    window.location.href = `statistics.html?tab=${tab}`;
  }
}





    function toggleMenu(id) {
      const submenu = document.getElementById(id);
      submenu.style.display = submenu.style.display === "block" ? "none" : "block";
    }

    function toggleSidebar() {
      document.getElementById("sidebar").classList.toggle("active");
    }

    function logout() {
      localStorage.removeItem("loggedInUser");
      window.location.href = "index.html";
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadStats();

      const cards = document.querySelectorAll(".card[data-status]");
      cards.forEach(card => {
        card.addEventListener("click", () => {
          const status = card.getAttribute("data-status") || "";
          openOrders(status);
        });
      });

      const addBtn = document.getElementById("card-add");
      if (addBtn) addBtn.addEventListener("click", openNewOrder);
    });
// โ ุงุณุชุฑุฌุงุน ุงููุณุชุฎุฏู ุงูุญุงูู
const loggedUser = JSON.parse(localStorage.getItem("loggedInUser"));
if (!loggedUser) window.location.href = "index.html";

const displayName = loggedUser.name || loggedUser.username || loggedUser.user || "ุบูุฑ ูุนุฑูู";
document.getElementById("userDisplay").textContent = `๐ ูุฑุญุจุงูุ ${displayName}`;
console.log(`ูุฑุญุจุงู ${displayName}! ุชู ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญ โ`);


// ๐งฉ ุงูุตูุงุญูุงุช
const roles = loggedUser.roles || [];

// ๐ฏ ุนูุงุตุฑ ุงููุงุฆูุฉ
const ordersMenu   = document.querySelector(".menu-item[onclick*='ordersMenu']");
const financeMenu  = document.querySelector(".menu-item[onclick*='financeMenu']");
const statsMenu    = document.querySelector(".menu-item[onclick*='openStatistics']");
const usersMenu    = document.getElementById("usersMenu");
const storeMenu    = document.querySelector(".menu-item[onclick*='openStore']");
const settingsMenu = document.querySelector(".menu-item[onclick*='openSettings']");

// ุฅุฎูุงุก ุงููู ุจุงูุจุฏุงูุฉ
if (ordersMenu) ordersMenu.style.display = "none";
if (financeMenu) financeMenu.style.display = "none";
if (statsMenu) statsMenu.style.display = "none";
if (usersMenu) usersMenu.style.display = "none";
if (storeMenu) storeMenu.style.display = "none";
if (settingsMenu) settingsMenu.style.display = "none";

// ๐ข ุงูุฃูุณุงู ุงูููุชูุญุฉ ููุฌููุน
if (storeMenu) storeMenu.style.display = "block";      // ุฅุฏุงุฑุฉ ุงููุฎุฒู
if (settingsMenu) settingsMenu.style.display = "block"; // ุงูุฅุนุฏุงุฏุงุช

// ๐ ุงูุฃูุณุงู ุญุณุจ ุงูุตูุงุญูุงุช

// โ ุงูุฃุฏูู: ูุดูู ูู ุดูุก
if (roles.includes("admin")) {
  if (ordersMenu) ordersMenu.style.display = "block";
  if (financeMenu) financeMenu.style.display = "block";
  if (statsMenu) statsMenu.style.display = "block";
  if (usersMenu) usersMenu.style.display = "block";
  if (storeMenu) storeMenu.style.display = "block";
}

// โ ุงููุญุงุณุจ: ุงูุญุณุงุจุงุช + ุงูุฅุญุตุงุฆูุงุช
if (roles.includes("accountant")) {
  if (financeMenu) financeMenu.style.display = "block";
  if (statsMenu) statsMenu.style.display = "block";
}

// โ ุงููุซุจูุช: ุงูุทูุจุงุช + ููุท ุฅุญุตุงุฆูุงุช ุงูุทูุจุงุช
if (roles.includes("stabilizer") && !roles.includes("admin")) {
  if (ordersMenu) ordersMenu.style.display = "block";

  // ูุนุฑุถ ููุท ูุณู "ุฅุญุตุงุฆูุงุช ุงูุทูุจุงุช" ุฏุงุฎู ูุงุฆูุฉ ุงูุฅุญุตุงุฆูุงุช
  const statsSubmenu = document.getElementById("statsMenu");
  if (statsSubmenu) {
    statsSubmenu.style.display = "block"; // ุนุฑุถ ุงููุงุฆูุฉ
    const items = statsSubmenu.querySelectorAll("div");
    items.forEach((el) => {
      // ูุฎูู ููุท ุฃูู ุนูุตุฑ ุงููู ุงุณูู "ุฅุญุตุงุฆูุงุช ุงูุทูุจุงุช" ุธุงูุฑ
      if (el.textContent.includes("ุงูุทูุจุงุช")) el.style.display = "block";
      else el.style.display = "none";
    });
  }
}

// โ ููุธู ุงููุฎุฒู
if (roles.includes("store")) {
  if (storeMenu) storeMenu.style.display = "block";
}

// โ ุงูููุฏูุจ: ุงูุทูุจุงุช ููุท
if (roles.includes("delivery")) {
  if (ordersMenu) ordersMenu.style.display = "block";
}

// ๐ฃ ุตูุงุญูุงุช ุงููุซุจุช (stabilizer) โ ุนุฑุถ ุตูุญุฉ ุชูุงุตูู ุงูููุชุฌุงุช ููุท
if (roles.includes("stabilizer") && !roles.includes("admin")) {
  // ุฅุฎูุงุก ูู ุนูุงุตุฑ ุงููุฎุฒู ูุคูุชูุง
  const storeSubmenu = document.getElementById("storeMenu");
  if (storeSubmenu) {
    const items = storeSubmenu.querySelectorAll("div");
    items.forEach(el => el.style.display = "none");

    // ุนุฑุถ ููุท "ุชูุงุตูู ุงูููุชุฌุงุช"
    const detailsItem = Array.from(items).find(el => el.textContent.includes("ุชูุงุตูู ุงูููุชุฌุงุช"));
    if (detailsItem) detailsItem.style.display = "block";
  }
}


    window.toggleMenu = toggleMenu;
    window.toggleSidebar = toggleSidebar;
    window.openOrders = openOrders;
    window.openNewOrder = openNewOrder;
    window.openStatistics = openStatistics;
    window.logout = logout;
    function openUsers() {
  window.location.href = "users.html";
}
window.openUsers = function() {// ๐ ุนุฑุถ ุงูุงุณู
const loggedUser = JSON.parse(localStorage.getItem("loggedInUser"));
if (loggedUser && loggedUser.user) {
  document.getElementById("userDisplay").textContent = `๐ ุฃููุงู ${loggedUser.user}!`;
}
  window.location.href = "users.html";
};


// โก ูุธุงู ุงูุนุจุงุฑุงุช ุงูุชุญููุฒูุฉ ุงูููููุฉ (ุจุฏูู ููุชุจุฉ ุฎุงุฑุฌูุฉ)
function loadMotivationalQuote() {
  const quotes = [
    "ุงุจุฏุฃ ูููู ุจุฅููุงูู ุจููุณูุ ููู ุฎุทูุฉ ุตุบูุฑุฉ ูุญู ูุฏูู ุชูุฑุจู ูู ุงููุฌุงุญ ุงููุจูุฑ.",
    "ุญูู ุชุธู ุฃู ุงูุทุฑูู ุงูุชููุ ุชุฐููุฑ ุฃู ุงููุงุฌุญูู ุตูุนูุง ุทุฑูููู ุนูุฏูุง ูู ูุฌุฏูุง ุทุฑูููุง ุฃุตููุง.",
    "ูุง ุชูุชุธุฑ ุงูุธุฑูู ูุชุชุญุณูุ ุจู ูู ุฃูุช ุงูุณุจุจ ูู ุชุญุณูููุง. ูุงููุฑุต ุชูุฎูู ูุง ุชููุชุธุฑ.",
    "ุงูุนูู ุงูุฌุงุฏ ุงูููู ูู ูุง ูุฌุนู ุบุฏู ูุฎุชูููุง ุนู ุงูุจููุฉ. ุงุฌุนู ูู ููู ุฎุทูุฉ ูุญู ุฃุญูุงูู.",
    "ุงููุฌุงุญ ูุง ูููุงุณ ุจูุง ูุตูุช ุฅูููุ ุจู ุจูุง ุชุบูุจุช ุนููู ูุชุตู ุฅูู ููุงู.",
    "ูุง ุชุฎู ูู ุงูุจุฏุงูุงุช ุงูุตุบูุฑุฉุ ููู ุฅูุฌุงุฒ ุนุธูู ุจุฏุฃ ุจุฎุทูุฉ ูุชูุงุถุนุฉ ูุดุบู ูุง ููุทูุฆ.",
    "ุงูุฅูุฌุงุฒ ูุง ูุญุชุงุฌ ูุนุฌุฒุฉุ ููุท ููุจ ูุง ูุนุฑู ุงูุงุณุชุณูุงู ูุนูู ูุคูู ุจุงูุญููู.",
    "ุงูุชุญุฏูุงุช ููุณุช ุนูุงุฆูุ ุจู ูุฑุต ูุชูุธูุฑ ููุชู ููุฏุฑุชู ุนูู ุงูุชููุฒ.",
    "ูู ูุซู ุงููุฎูุฉุ ุชูุฑูู ุจุงูุญุฌุงุฑุฉ ูุชุนุทู ุฃุทูุจ ุงูุซูุงุฑ. ุงุฌุนู ุตุนูุจุงุชู ุฏุงูุนูุง ูุง ุญุงุฌุฒูุง.",
    "ูุง ุชุฒุฑุนู ูู ุฌูุฏ ุงููููุ ุณุชุญุตุฏู ุบุฏูุง ูุฌุงุญูุง ูููุฃ ุญูุงุชู ูุฎุฑูุง ูุณุนุงุฏุฉ.",
    "ูุง ุชุณุชููู ุจุฃู ุฅูุฌุงุฒุ ููู ุฎุทูุฉ ูุญู ุงูุฃูุถู ูู ูุตุฑู ุนูู ุงูุชุฑุฏุฏ ูุงููุณู.",
    "ูู ุตุจุงุญ ูู ูุฑุตุฉ ุฌุฏูุฏุฉ ูุชุซุจุช ุฃูู ูุงุฏุฑ ุนูู ุฃู ุชููู ุฃูุถู ูู ุงูุฃูุณ.",
    "ุงูุซูุฉ ุจุงูููุณ ูุง ุชุนูู ุฃูู ุงูุฃูุถูุ ุจู ุฃูู ูุง ุชูุงุฑู ููุณู ุจุฃุญุฏ.",
    "ุงูุทููุญ ูู ุงููููุฏ ุงูุฐู ูุฌุนู ุงูุฃูุงู ุงูุตุนุจุฉ ูุฌุฑุฏ ูุฑุงุญู ูู ุทุฑูู ุงููุฌุงุญ.",
    "ูุง ุชูุธุฑ ููููู ูู ุจุนูุฏุ ุงุตุนุฏ ุจุฎุทูุงุช ุซุงุจุชุฉุ ูุณุชุตู ุนุงุฌูุงู ุฃู ุขุฌูุงู.",
    "ุงููุดู ููุณ ุนุฏููุ ุจู ูุนููู ุงูุฐู ูุฏูุนู ูุชุชุนูู ููู ุชุตู ุจุดููู ุฃููู."
  ];

  // ๐ง ุงุฎุชูุงุฑ ุญููุฉ ุนุดูุงุฆูุฉ
  const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];

  // ๐พ ุญูุธ ุขุฎุฑ ุญููุฉ ูุนุฏู ุชูุฑุงุฑูุง ูุจุงุดุฑุฉ
  localStorage.setItem("lastQuote", randomQuote);

  // ๐จ ุฅูุดุงุก ูุฑุจุน ุงูุนุฑุถ ุงูุจุฑุชูุงูู
  const quoteBox = document.createElement("div");
  quoteBox.innerHTML = `<strong>๐ฌ ${randomQuote}</strong>`;
  quoteBox.id = "quoteBox";
  quoteBox.style.background = "#FF6B2D";
  quoteBox.style.color = "white";
  quoteBox.style.padding = "16px";
  quoteBox.style.margin = "18px 0";
  quoteBox.style.borderRadius = "10px";
  quoteBox.style.textAlign = "center";
  quoteBox.style.fontWeight = "bold";
  quoteBox.style.fontSize = "16px";
  quoteBox.style.lineHeight = "1.8";
  quoteBox.style.direction = "rtl";
  quoteBox.style.boxShadow = "0 3px 10px rgba(0,0,0,0.15)";
  quoteBox.style.animation = "fadeIn 1.5s ease";
  quoteBox.style.transition = "transform 0.8s ease";
  quoteBox.style.transform = "translateY(10px)";
  setTimeout(() => (quoteBox.style.transform = "translateY(0)"), 100);

  const header = document.getElementById("userDisplay");
  if (header) {
    const old = document.getElementById("quoteBox");
    if (old) old.remove();
    header.after(quoteBox);
  }
}
// ๐ ุชูููุฐ ุชููุงุฆู ุนูุฏ ุงูุฏุฎูู ูููุญุฉ ุงูุชุญูู
loadMotivationalQuote();

// โ ูุชุญ ุตูุญุงุช ุงููุฎุฒู ุญุณุจ ุงููุณู
function openStore(tab) {
  if (tab === "purchases") {
    window.location.href = "purchases.html"; // ุตูุญุฉ ุงููุดุชุฑูุงุช
  } else if (tab === "daily") {
    window.location.href = "daily-inventory.html"; // โ ุตูุญุฉ ุงูุฌุฑุฏ ุงููููู ุงูุฌุฏูุฏุฉ
  } else if (tab === "losses") {
    window.location.href = "losses.html"; // ุตูุญุฉ ุงูุชุงูู ูุงูุฎุณุงุฆุฑ
  } else if (tab === "summary") {
    window.location.href = "inventory-summary.html"; // ุตูุญุฉ ุงูุฌุฑุฏ ุงูุดูุฑู
  }
}
window.openStore = openStore;

// ๐น ุฏุงูุฉ ุงูุชุตููุฑ ุงูุฐูู
async function monthlySmartReset() {
  const dbRef = ref(db);
  const monthKey = new Date().toISOString().slice(0,7); // ูุซุงู: 2025-11
  const confirmReset = confirm("โ๏ธ ูู ุฃูุช ูุชุฃูุฏ ูู ุชุตููุฑ ุจูุงูุงุช ุงูุดูุฑุ ุณูุชู ุฃุฑุดูุฉ ุงูุทูุจุงุช ุงูููุชููุฉ ูุงูููุงุชูุฑ ูุงูุญุณุงุจุงุช.");

  if (!confirmReset) return;

  try {
    // ๐ ุฌูุจ ุงูุทูุจุงุช
    const ordersSnap = await get(child(dbRef, "orders"));
    if (ordersSnap.exists()) {
      const allOrders = ordersSnap.val();
      const keepStatuses = ["ูุซุจุช", "ููุฏ ุงููุนุงูุฌุฉ", "ููุฏ ุงูุชุฌููุฒ", "ููุฏ ุงูุชูุตูู", "ุฑุงุฌุน"];
      const archiveStatuses = ["ุชู ุงูุชุณููู", "ุชู ุงุณุชูุงู ุงูุฑุงุฌุน", "ุฑูุถ"];

      const newOrders = {};
      const archiveOrders = {};

      for (const [id, o] of Object.entries(allOrders)) {
        if (archiveStatuses.includes(o.status)) archiveOrders[id] = o;
        else if (keepStatuses.includes(o.status)) newOrders[id] = o;
      }

      await set(ref(db, `archive/${monthKey}/orders`), archiveOrders);
      await set(ref(db, "orders"), newOrders);
    }

    // ๐ข ุงูููุงุชูุฑ ูุงูุญุณุงุจุงุช
    const invoicesSnap = await get(child(dbRef, "invoices"));
    const accountsSnap = await get(child(dbRef, "accounts"));
    const invoices = invoicesSnap.exists() ? invoicesSnap.val() : {};
    const accounts = accountsSnap.exists() ? accountsSnap.val() : {};

    await set(ref(db, `archive/${monthKey}/invoices`), invoices);
    await set(ref(db, `archive/${monthKey}/accounts`), accounts);

    await set(ref(db, "invoices"), {});
    await set(ref(db, "accounts"), {});

    // ๐ฃ ุชูุธูู ุณุฌู ุงููุนุงูุฌุงุช ุจุงููุฎุฒู
    const warehouseSnap = await get(child(dbRef, "warehouse"));
    if (warehouseSnap.exists()) {
      const warehouse = warehouseSnap.val();
      for (const name in warehouse) {
        warehouse[name].processedOrders = {};
      }
      await update(ref(db, "warehouse"), warehouse);
    }

    alert("โ ุชู ุชุตููุฑ ุจูุงูุงุช ุงูุดูุฑ ูุฃุฑุดูุชูุง ุจูุฌุงุญ!");
  } catch (err) {
    console.error("โ ุฎุทุฃ ุฃุซูุงุก ุชุตููุฑ ุงูุจูุงูุงุช:", err);
    alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุชุตููุฑ. ุชุญูู ูู ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช.");
  }
}
// ๐ ุฅุฎูุงุก ุฒุฑ ุงูุฃุฑุดูู ุงูุดูุฑู ูุบูุฑ ุงูุฃุฏูู
const archiveMenu = document.querySelector(".menu-item[onclick*='openArchive']");
if (archiveMenu && (!roles.includes("admin"))) {
  archiveMenu.style.display = "none";
}

// ๐๏ธ ูุชุญ ุตูุญุฉ ุงูุฃุฑุดูู ุงูุดูุฑู
function openArchive() {
  window.location.href = "monthly-archive.html";
}
window.openArchive = openArchive;

  </script>
<!-- โ ูุธุงู ุฅุดุนุงุฑ ุงูุทูุจ ุงูุฌุฏูุฏ (ููุณ ููุฏ ุตูุญุฉ ุงูุทูุจุงุช) -->
<script>

  // โ ุฏุงูุฉ ุนุฑุถ ุงูุฅุดุนุงุฑ ูุงูุตูุช (ููุณ ุงูููุฌูุฏ ุจุตูุญุฉ ุงูุทูุจุงุช)
  function showNewOrderNotification(count = 1) {
    const oldBar = document.getElementById("newOrderBar");
    if (oldBar) oldBar.remove();

    const bar = document.createElement("div");
    bar.id = "newOrderBar";
    bar.innerHTML = `
      <div style="display:flex;align-items:center;gap:12px;animation:fadeInUp 0.4s ease">
        <span style="font-size:28px;background:#fff;color:#28a745;border-radius:50%;
        width:46px;height:46px;display:flex;align-items:center;justify-content:center;
        box-shadow:0 0 10px rgba(255,255,255,0.3)">๐ต</span>
        <div>
          <div style="font-weight:bold;font-size:16px;">ูุตู ${count} ุทูุจ ุฌุฏูุฏ${count>1?"ุงุช":""}!</div>
          <div style="font-size:13px;opacity:0.9;">ุชุญูู ุงูุขู ูู ุงูุทูุจุงุช</div>
        </div>
      </div>
    `;
    Object.assign(bar.style, {
      position: "fixed",
      bottom: "25px",
      right: "25px",
      background: "linear-gradient(135deg,#28a745,#20c997)",
      color: "white",
      padding: "14px 22px",
      borderRadius: "16px",
      fontFamily: "Tajawal, sans-serif",
      boxShadow: "0 8px 25px rgba(0,0,0,0.3)",
      zIndex: "999999",
      cursor: "pointer",
      opacity: "1",
      transition: "all 0.6s ease"
    });
    document.body.appendChild(bar);

    if (window.soundAllowed) {
const audio = new Audio("cash-register-kaching.mp3");
      audio.volume = 1.0;
      audio.play().catch(err => console.warn("๐ ูุดู ุชุดุบูู ุงูุตูุช:", err));
    }

    bar.addEventListener("mouseenter",()=>bar.style.transform="scale(1.05)");
    bar.addEventListener("mouseleave",()=>bar.style.transform="scale(1)");

    setTimeout(()=>{
      bar.style.opacity="0";
      bar.style.transform="translateY(20px)";
      setTimeout(()=>bar.remove(),600);
    },6000);

    const style=document.createElement("style");
    style.textContent=`
      @keyframes fadeInUp {
        from {opacity:0;transform:translateY(40px);}
        to {opacity:1;transform:translateY(0);}
      }`;
    document.head.appendChild(style);
  }

  // โ ูุฑุงูุจุฉ ุงูุทูุจุงุช ุงูุฌุฏูุฏุฉ ูุซู ุตูุญุฉ ุงูุทูุจุงุช ุชูุงูุงู
  import("https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js").then(async ({ initializeApp }) => {
    const { getDatabase, ref, onValue } = await import("https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js");
    const app = initializeApp({
      apiKey: "AIzaSyDtEJYJrmyP45qS2da8Cuc6y6Jv5VD0Uhc",
      authDomain: "almurad-system.firebaseapp.com",
      databaseURL: "https://almurad-system-default-rtdb.firebaseio.com/",
      projectId: "almurad-system",
      storageBucket: "almurad-system.appspot.com",
      messagingSenderId: "911755824405",
      appId: "1:911755824405:web:2bfbd18ddcf038ca48ad1c"
    });

    const db = getDatabase(app);
    const ordersRef = ref(db, "orders");
    let previousCount = 0;

    onValue(ordersRef, (snapshot) => {
      if (!snapshot.exists()) return;
      const data = snapshot.val();
      const count = Object.keys(data).length;
      if (previousCount && count > previousCount) {
        const diff = count - previousCount;
        showNewOrderNotification(diff);
      }
      previousCount = count;
    });
  });

<!-- โ ุชูุนูู ุฅุฐู ุงูุตูุช ุจุฏูู ุชุดุบูู ุฃู ููู -->
document.addEventListener("touchstart", function enableSoundOnce() {
  try {
    // ุฅูุดุงุก ูุงุฆู ุตูุช ุจุฏูู ุชุญููู ููู
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const source = ctx.createBufferSource();
    source.connect(ctx.destination);
    // ููุท ูุชูุนูู ุฅุฐู ุงูุตูุช โ ูุง ุชุดุบูู ูุนูู
  } catch (e) {
    console.warn("โ๏ธ ูู ูุชู ุชูุนูู ุงูุตูุช ุจุนุฏ:", e);
  }
  window.soundAllowed = true; // โ ุชู ุชูุนูู ุงูุฅุฐู
  console.log("๐ ุชู ุชูุนูู ุฅุฐู ุงูุตูุช ุจุฏูู ุฃู ุตูุช ูุนูู");
  document.removeEventListener("touchstart", enableSoundOnce);
}, { once: true });

document.addEventListener("click", enableSoundOnce, { once: true });

</script>
</body>
</html>
