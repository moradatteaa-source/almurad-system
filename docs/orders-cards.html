<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø§Ù„Ø·Ù„Ø¨Ø§Øª</title>

<style>
  
.status-badge {
  display: inline-block;
  padding: 3px 8px;
  border-radius: 6px;
  font-size: 11px;
  font-weight: bold;
  margin-top: 4px;
  color: white;
}

/* Ø­Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯ */
.status-new {
  background: #4FA3FF;   /* Ø£Ø²Ø±Ù‚ ÙØ§ØªØ­ */
  color: white;
}


/* Ø¬Ø¯ÙŠØ¯ (Ù‚Ø¯ÙŠÙ…Ø© â€“ Ù„Ø§ Ù†Ø³ØªØ®Ø¯Ù…Ù‡Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¢Ù†) */
.status-blank { background: #7f8c8d; }


/* Ø¬Ø¯ÙŠØ¯ */
.status-blank { background: #7f8c8d; }

/* Ù…Ø«Ø¨Øª */
.status-mothabet { background: #1abc9c; }

/* Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© */
.status-processing { background: #e67e22; }

/* Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ² */
.status-preparing { background: #f39c12; }

/* Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø© */
.status-waiting-goods { background: #9b59b6; }

/* Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„ */
.status-delivery { background: #f1c40f; color:black; }

/* ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ… */
.status-delivered { background: #2ecc71; }

/* Ø±Ø§Ø¬Ø¹ */
.status-return { background: #e74c3c; }

/* ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø±Ø§Ø¬Ø¹ */
.status-return-received { background: #c0392b; }

/* Ø±ÙØ¶ */
.status-rejected { background: #7f8c8d; }

/* ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ */
.status-unknown { background: #95a5a6; }


  #searchIcon {
  stroke: #FF6B2D80; /* Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ø®ÙÙŠÙ */
}

.header-fixed {
  position: fixed;
  top: 0;
  right: 0;
  left: 0;
  z-index: 9999;
  background: #043B64;
  color: white;
  padding: 14px;
  margin: 0;
  text-align: center;
  font-size: 18px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}

/* Ø³Ù‡Ù… Ø§Ù„Ø±Ø¬ÙˆØ¹ */
.back-arrow {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 20px;
  cursor: pointer;
}

/* Ø­ØªÙ‰ Ù„Ø§ ØªØªØºØ·Ù‰ Ø§Ù„Ø·Ù„Ø¨Ø§Øª */
body {
  padding-top: 60px !important;
}

  /* â–¼ ØªØ­Ù…ÙŠÙ„ Ø®Ø· Tajawal Ø§Ù„Ù…Ø­Ù„ÙŠ â–¼ */
  @font-face {
    font-family: 'Tajawal';
    src: url('Tajawal-Regular.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
  }

  body {
    font-family: 'Tajawal', sans-serif;
    margin: 0;
    padding: 0;
    background: #f4f4f4;
  }

  .order-card {
    background: #fff;
    margin: 10px;
    padding: 12px;
    border-radius: 10px;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    box-shadow: 0 2px 5px rgba(0,0,0,0.08);
    cursor: pointer;
  }

  /* â–¼ ÙŠÙ…ÙŠÙ† Ø§Ù„ÙƒØ§Ø±Øª â€” Ø§Ù„Ù…Ù†ØªØ¬ + Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ + Ø§Ù„ØªØ§Ø±ÙŠØ® â–¼ */
  .right-side {
    text-align: right;
  }

  .date {
    font-size: 11px;
    color: #777;
    opacity: 0.8;
    margin-bottom: 4px;
    font-weight: normal !important;
  }

  .order-id {
  font-size: 16px;       /* Ø£ÙƒØ¨Ø± */
  color: #043B64;        /* Ù„ÙˆÙ† Ø·ÙˆØ® */
  font-weight: 700;      /* ØºØ§Ù…Ù‚ */
}

.product-name {
  color: #FF6B2D;
  font-size: 13px;
  font-weight: bold;
}



  /* â–¼ ÙŠØ³Ø§Ø± Ø§Ù„ÙƒØ§Ø±Øª â€” Ø§Ù„Ø¹Ø¯Ø¯ + Ø§Ù„Ø³Ø¹Ø± + Ø§Ù„Ù…Ø¹Ù„Ù† â–¼ */
  .left-side {
    text-align: left;
  }

  .qty {
    font-size: 12px;
    color: #333;
    font-weight: normal !important;
  }

  .price {
    font-size: 13px;
    color: #000;
    font-weight: normal !important;
    margin-top: 4px;
  }

  .advertiser {
    font-size: 11px;
    color: #666;
    margin-top: 4px;
    font-weight: normal !important;
  }

  .line {
    height: 1px;
    background: #ddd;
    margin: 6px 0 0 0;
  }
#ordersList { margin-top: 0; transition: 0.2s; }

</style>

</head>

<body>

<h2 id="pageTitle" class="header-fixed">

  <span id="backBtn" class="back-arrow">â®</span>

  <span id="titleText">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span>
<!-- 1ï¸âƒ£ Ø«Ù„Ø§Ø« Ù†Ù‚Ø§Ø· -->
<span id="menuIcon" style="
  position:absolute;
  left:12px;
  top:50%;
  transform:translateY(-50%);
  font-size:22px;
  cursor:pointer;
">â‹®</span>
<!-- â–¼â–¼â–¼ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„ÙˆØ³ÙŠØ· â–¼â–¼â–¼ -->
<div id="menuDropdown" style="
    display:none;
    position:absolute;
    left:10px;
    top:60px;
    background:white;
    border:1px solid #ddd;
    border-radius:8px;
    box-shadow:0 2px 8px rgba(0,0,0,0.2);
    z-index:99999;
    width:180px;
  
">
<style>
  #menuDropdown .menu-item {
    color: #043B64 !important;
    font-weight: 600;
    font-size: 14px;
  }

  #menuDropdown .menu-item:hover {
    background: #f2f2f2;
  }
</style>

<div class="menu-item" id="sendToWaseet" style="padding:10px; cursor:pointer; border-bottom:1px solid #eee;">
  ğŸ“¤ Ø±ÙØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù„Ù„Ø´Ø­Ù†
</div>

<div class="menu-item" id="shippingLogs" style="padding:10px; cursor:pointer;">
  ğŸ“¦ Ø³Ø¬Ù„ Ø§Ù„Ø´Ø­Ù†Ø§Øª
</div>


</div>
<!-- â–²â–²â–² Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© â–²â–²â–² -->

<!-- 2ï¸âƒ£ Ø§Ù„Ø¨Ø­Ø« (SVG) -->
<svg id="searchIcon" xmlns="http://www.w3.org/2000/svg"
  width="20" height="20" viewBox="0 0 24 24"
  fill="none" stroke="#FF6B2D" stroke-width="2"
  stroke-linecap="round" stroke-linejoin="round"
  style="cursor:pointer; position:absolute; left:45px; top:50%; transform:translateY(-50%);">
  <circle cx="11" cy="11" r="8"></circle>
  <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
</svg>


<!-- 3ï¸âƒ£ Ø§Ù„ÙÙ„ØªØ±Ø© â€” SVG Ø§Ø­ØªØ±Ø§ÙÙŠ -->
<svg id="filterIcon" xmlns="http://www.w3.org/2000/svg" 
  width="20" height="20" viewBox="0 0 24 24" 
  fill="none"stroke="#FF6B2D" stroke-width="2"
  stroke-linecap="round" stroke-linejoin="round"
  style="cursor:pointer; position:absolute; left:75px; top:50%; transform:translateY(-50%);">
  <polygon points="3 4 21 4 14 12 14 20 10 20 10 12 3 4"></polygon>
</svg>

</h2>

<!-- â­ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙÙ„ØªØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ -->
<div id="filterBoxContainer" style="
  display:none;
  position:fixed;
  top:60px;
  right:0;
  left:0;
  background:white;
  padding:12px;
  z-index:9999;
  box-shadow:0 2px 6px rgba(0,0,0,0.25);
  border-radius:0 0 10px 10px;
">

  <!-- â–¸ ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†ØªØ¬ -->
  <div class="acc-header" id="accProdHeader"
       style="padding:10px; background:#f5f5f5; border-radius:8px; cursor:pointer; font-weight:bold; color:#043B64;">
    ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†ØªØ¬ â–¸
  </div>

  <div id="accProdBody" style="display:none; padding:10px;">
    
    <!-- ğŸ” Ø¨Ø­Ø« Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
    <input id="prodSearch" type="text" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬..."
           style="width:100%; padding:8px; border:1px solid #ccc; border-radius:6px; margin-bottom:10px;">

    <!-- âœ” ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„ -->
    <label style="display:flex; align-items:center; gap:6px; margin-bottom:8px; font-size:14px;">
      <input type="checkbox" id="prodSelectAll"> ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„
    </label>

    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
    <div id="prodList" style="max-height:180px; overflow-y:auto; border:1px solid #ddd; padding:8px; border-radius:8px;"></div>
  </div>


  <!-- â–¸ ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù† -->
  <div class="acc-header" id="accAdvHeader"
       style="padding:10px; background:#f5f5f5; border-radius:8px; cursor:pointer; font-weight:bold; color:#043B64; margin-top:10px;">
    ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù† â–¸
  </div>

  <div id="accAdvBody" style="display:none; padding:10px;">
    
    <!-- ğŸ” Ø¨Ø­Ø« Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¹Ù„Ù†ÙŠÙ† -->
    <input id="advSearch" type="text" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¹Ù„Ù†..."
           style="width:100%; padding:8px; border:1px solid #ccc; border-radius:6px; margin-bottom:10px;">

    <!-- âœ” ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„ -->
    <label style="display:flex; align-items:center; gap:6px; margin-bottom:8px; font-size:14px;">
      <input type="checkbox" id="advSelectAll"> ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„
    </label>

    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ù„Ù†ÙŠÙ† -->
    <div id="advList" style="max-height:180px; overflow-y:auto; border:1px solid #ddd; padding:8px; border-radius:8px;"></div>
  </div>

  <!-- Ø²Ø± ØªØ·Ø¨ÙŠÙ‚ -->
  <button id="applyFilter" style="
    width:100%; padding:10px; margin-top:10px;
    background:#043B64; color:white; border:none; border-radius:8px;
    font-size:15px; cursor:pointer;">
    ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ±Ø©
  </button>

</div>


</div>

<!-- ğŸ” ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ -->
<div id="searchBoxContainer" style="
  display:none;
  position:fixed;
  top:70px;
  left:10px;
  right:10px;
  background:white;
  padding:12px;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,0.15);
  z-index:9999;
">

  <!-- Ø³Ø·Ø± Ø§Ù„Ø¨Ø­Ø« -->
  <div style="display:flex; align-items:center; gap:10px;">
    
    <input id="searchInput" type="text" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§..."
      style="
        flex:1;
        padding:10px 14px;
        font-size:16px;
        border:1px solid #ccc;
        border-radius:8px;
        outline:none;
      ">
    
    <!-- Ø²Ø± Ø¥ØºÙ„Ø§Ù‚ -->
    <button id="closeSearch" style="
      background:#eee;
      border:none;
      width:36px;
      height:36px;
      border-radius:8px;
      font-size:18px;
      cursor:pointer;
    ">âœ•</button>
  </div>

  <!-- Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø­Ø« -->
  <div style="
    margin-top:14px;
    display:flex;
    gap:10px;
    justify-content:space-between;
  ">

    <button class="searchTypeBtn" data-type="orderId"
      style="flex:1; padding:10px; border-radius:8px; border:1px solid #043B64; background:#E6F3FF;">
      Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨
    </button>

    <button class="searchTypeBtn" data-type="phone"
      style="flex:1; padding:10px; border-radius:8px; border:1px solid #043B64; background:white;">
      Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
    </button>

    <button class="searchTypeBtn" data-type="customerCode"
      style="flex:1; padding:10px; border-radius:8px; border:1px solid #043B64; background:white;">
      ÙƒÙˆØ¯ Ø§Ù„Ø²Ø¨ÙˆÙ†
    </button>

  </div>

  <!-- Ø£Ø²Ø±Ø§Ø± ØªÙ†ÙÙŠØ° Ø§Ù„Ø¨Ø­Ø« -->
  <div style="margin-top:16px; display:flex; gap:10px;">
    <button id="doSearch" style="
      flex:1;
      padding:10px;
      background:#043B64;
      color:white;
      border:none;
      border-radius:8px;
      font-size:16px;
      font-weight:600;
    ">Ø¨Ø­Ø«</button>

    <button id="cancelSearch" style="
      flex:1;
      padding:10px;
      background:#FF6B2D;
      color:white;
      border:none;
      border-radius:8px;
      font-size:16px;
      font-weight:600;
    ">Ø¥Ù„ØºØ§Ø¡</button>
  </div>
</div>



</h2>

<div id="ordersList"></div>

<script type="module">

  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
  import { getDatabase, ref, onValue }
    from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDtEJYJrmyP45qS2da8Cuc6y6Jv5VD0Uhc",
    authDomain: "almurad-system.firebaseapp.com",
    databaseURL: "https://almurad-system-default-rtdb.firebaseio.com/",
    projectId: "almurad-system",
    storageBucket: "almurad-system.appspot.com",
    messagingSenderId: "911755824405",
    appId: "1:911755824405:web:2bfbd18ddcf038ca48ad1c"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const ordersRef = ref(db, "orders");

  const ordersList = document.getElementById("ordersList");

  function formatPrice(num) {
    return Number(num).toLocaleString("en-US");
  }

  function formatDateOnly(full) {
    if (!full) return "";
    return full.split("T")[0];
  }

  onValue(ordersRef, (snapshot) => {
    if (!snapshot.exists()) {
      ordersList.innerHTML = "<p style='text-align:center'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</p>";
      return;
    }
allOrdersList = [];
originalOrders = [];
masterOrders = [];

const data = snapshot.val();

// â­ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù…Ù† ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª â†’ snapshot Ø§Ù„ÙƒØ§Ù…Ù„
snapshotAllOrders = Object.entries(data).map(([id, o]) => ({ id, ...o }));


const filterStatus = localStorage.getItem("currentFilterStatus") || "";

const orders = Object.entries(data)
  .map(([id, o]) => ({ id, ...o }))
  .filter(o => {
    // â­ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ø¨Ø¯ÙˆÙ† Ø­Ø§Ù„Ø©)
    if (!filterStatus || filterStatus === "new") {
      return !o.status || o.status === "";
    }

    // â­ ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø­Ø§Ù„Ø©
    return o.status === filterStatus;
  })
  .sort((a, b) => (b.enterIndex || 0) - (a.enterIndex || 0));

masterOrders = [...orders];     // Ø§Ù„Ø£ØµÙ„ÙŠØ© Ø«Ø§Ø¨ØªØ© Ø¯Ø§Ø¦Ù…Ø§Ù‹
// â­ ØªØ¹Ø¨Ø¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
const prodList = document.getElementById("prodList");
prodList.innerHTML = "";

const uniqueProducts = [...new Set(masterOrders.map(o => o.productName).filter(Boolean))];

uniqueProducts.forEach(p => {
  const lbl = document.createElement("label");
  lbl.style = "display:flex; align-items:center; gap:6px; margin-bottom:6px;";
  lbl.innerHTML = `
    <input type="checkbox" class="prodCheck" value="${p}">
    <span>${p}</span>
  `;
  prodList.appendChild(lbl);
});

// â­ ØªØ¹Ø¨Ø¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ù„Ù†ÙŠÙ†
const advList = document.getElementById("advList");
advList.innerHTML = "";

const uniqueAdvertisers = [...new Set(masterOrders.map(o => o.advertiser).filter(Boolean))];

uniqueAdvertisers.forEach(a => {
  const lbl = document.createElement("label");
  lbl.style = "display:flex; align-items:center; gap:6px; margin-bottom:6px;";
  lbl.innerHTML = `
    <input type="checkbox" class="advCheck" value="${a}">
    <span>${a}</span>
  `;
  advList.appendChild(lbl);
});

const savedFilterActive = localStorage.getItem("filterActive") === "1";
const savedProducts = JSON.parse(localStorage.getItem("filterProducts") || "[]");
const savedAdvertisers = JSON.parse(localStorage.getItem("filterAdvertisers") || "[]");

let finalOrders = [...orders];

if (savedFilterActive) {

  // ÙÙ„ØªØ±Ø© Ù…Ù†ØªØ¬Ø§Øª
  if (savedProducts.length > 0) {
    finalOrders = finalOrders.filter(o => savedProducts.includes(o.productName));
  }

  // ÙÙ„ØªØ±Ø© Ù…Ø¹Ù„Ù†ÙŠÙ†
  if (savedAdvertisers.length > 0) {
    finalOrders = finalOrders.filter(o => savedAdvertisers.includes(o.advertiser));
  }

  // Ù„ÙˆÙ† Ø§Ù„Ø²Ø±
  document.getElementById("filterIcon").style.stroke = "#FF6B2D";

} else {
  // Ø¥Ø°Ø§ Ø§Ù„ÙÙ„ØªØ±Ø© Ù…Ø·ÙÙŠØ© â†’ Ù„Ø§Ø²Ù… Ù†Ø±Ø¬Ø¹ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ
  document.getElementById("filterIcon").style.stroke = "#FF6B2D80";
}

// Ø¨Ø¹Ø¯ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:
renderOrders(finalOrders);
allOrdersList = Object.entries(data).map(([id, o]) => ({ id, ...o }));
originalOrders = [...finalOrders];



    // â­ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¨Ø­Ø« Ù…Ø­ÙÙˆØ¸
// â­ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¨Ø­Ø« Ù…Ø­ÙÙˆØ¸ â€” Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
const activeSearch = localStorage.getItem("activeSearch");
const savedQuery = localStorage.getItem("searchQuery");
const savedType = localStorage.getItem("searchType") || "orderId";

if (activeSearch === "1" && savedQuery) {
  const q = normalizeNumber(savedQuery.trim().toLowerCase());

  // â­ Ø§Ù„Ø¨Ø­Ø« ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
const filtered = snapshotAllOrders.filter(o => {
    const id = normalizeNumber(String(o.id || "").toLowerCase());
    const phone1 = normalizeNumber(String(o.phone1 || "").toLowerCase());
    const phone2 = normalizeNumber(String(o.phone2 || "").toLowerCase());
    const code = normalizeNumber(String(o.customerCode || "").toLowerCase());

    if (savedType === "orderId") return id.includes(q);
    if (savedType === "phone") return phone1.includes(q) || phone2.includes(q);
    if (savedType === "customerCode") return code.includes(q);

    return false;
  });

  renderOrders(filtered);

  document.getElementById("searchIcon").style.stroke = "#FF6B2D";
  document.getElementById("searchIcon").dataset.activeSearch = "1";
  document.getElementById("searchInput").value = savedQuery;

  return;   // ğŸ”¥ ÙŠÙ…Ù†Ø¹ Firebase Ù…Ù† Ø­Ø°Ù Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«
}



  });
  
</script>
<script type="module">
import {
  sendOrdersToWaseet,
  loginToWaseet
} from "./deliveryService.js";


document.getElementById("sendToWaseet").onclick = () => {
  window.location.href = "send-shipping.html";
};



document.getElementById("shippingLogs").onclick = () => {
  localStorage.setItem("logsSource", "orders");
  window.location.href = "shipping-logs.html";
};


document.addEventListener("DOMContentLoaded", () => {

  // â­ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù…Ù† ØµÙØ­Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„
  const savedScroll = parseInt(localStorage.getItem("restoreAfterFirebase")) || 0;
  if (savedScroll > 0) {
    setTimeout(() => window.scrollTo(0, savedScroll), 300);
  }

  // â­ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ø£Ùˆ Ù…Ù† localStorage
  const params = new URLSearchParams(window.location.search);
  let status = params.get("status");
    // â­ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
  const active = localStorage.getItem("activeSearch");
  const savedQuery = localStorage.getItem("searchQuery");


  const savedStatus = localStorage.getItem("currentFilterStatus");

  // Ø¥Ø°Ø§ Ù…Ø§ÙƒÙˆ status Ø¨Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ø³ØªØ±Ø¬Ø¹Ù‡ Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ†
  if ((!status || status === "undefined") && savedStatus) {
    status = savedStatus;
    params.set("status", status);
    window.history.replaceState({}, "", `${location.pathname}?${params.toString()}`);
  }

  // â­ ØªØºÙŠÙŠØ± Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
  const titleEl = document.getElementById("titleText");
  titleEl.textContent = !status ? "Ø§Ù„Ø·Ù„Ø¨Ø§Øª â€“ Ø¬Ø¯ÙŠØ¯Ø©" : "Ø§Ù„Ø·Ù„Ø¨Ø§Øª â€“ " + status;

  // â­ Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹
  document.getElementById("backBtn").addEventListener("click", () => {
    window.location.href = "dashboard.html";
  });

  // â­ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù…Ù† ØµÙØ­Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„
  window.addEventListener("message", (event) => {
    if (event.data === "closeDetails") {
      localStorage.setItem("restoreAfterFirebase", window.scrollY);
    }
  });

});
</script>

<script>
// â­ Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
let snapshotAllOrders = [];

let masterOrders = [];    // Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© (ØªØªØ¹Ø¨Ù‰ Ù…Ù† Firebase ÙÙ‚Ø·)
let originalOrders = [];  // ØªØªØºÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„ÙÙ„ØªØ±Ø© ÙˆØ§Ù„Ø¨Ø­Ø«
let allOrdersList = [];   // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„ Ø­Ø§Ù„ÙŠØ§Ù‹

const params = new URLSearchParams(window.location.search);
let filterStatus = params.get("status") || "";
localStorage.setItem("currentFilterStatus", filterStatus);
let filterActive = localStorage.getItem("filterActive") === "1";
function getStatusClass(status) {
if (!status || status.trim() === "") return "status-new";

  const map = {
    "Ù…Ø«Ø¨Øª": "status-mothabet",
    "Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©": "status-processing",
    "Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²": "status-preparing",
    "Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø©": "status-waiting-goods",
    "Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„": "status-delivery",
    "ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…": "status-delivered",
    "Ø±Ø§Ø¬Ø¹": "status-return",
    "ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø±Ø§Ø¬Ø¹": "status-return-received",
    "Ø±ÙØ¶": "status-rejected"
  };

  return map[status] || "status-unknown";
}



// â­ Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
function renderOrders(list) {
  allOrdersList = list;
  originalOrders = list;

  const ordersList = document.getElementById("ordersList");
  ordersList.innerHTML = "";

  list.forEach((o) => {
    const card = document.createElement("div");
    card.className = "order-card";
    card.setAttribute("data-id", o.id);

    card.innerHTML = `
   <div class="right-side" style="display:flex; flex-direction:column;">
  <div class="date">${(o.orderDate || "").split("T")[0]}</div>

  <div style="display:flex; justify-content:space-between; align-items:center; gap:6px;">
    <div class="order-id">#${o.id}</div>
    <div class="product-name">${o.totalProducts || o.productName || "-"}</div>
  </div>
</div>

      <div class="left-side">
<div class="qty">${o.totalQty || o.quantity || 1}</div>
<div class="price">${Number(o.totalPrice || o.price || 0).toLocaleString("en-US")} Ø¯.Ø¹</div>
        <div class="advertiser">${o.advertiser || ""}</div>
        <div class="status-badge ${getStatusClass(o.status)}">
  ${o.status && o.status.trim() !== "" ? o.status : "Ø¬Ø¯ÙŠØ¯"}
</div>

      </div>
    `;

    card.onclick = () => {
      localStorage.setItem("selectedOrder", o.id);
      localStorage.setItem("previousScrollPosition", window.scrollY);
      localStorage.setItem("currentFilterStatus", filterStatus);
      window.location.href = "order-details.html";
    };

    ordersList.appendChild(card);

    const line = document.createElement("div");
    line.className = "line";
    ordersList.appendChild(line);
  });
}
// â­ ÙØªØ­ ÙˆØ¥ØºÙ„Ø§Ù‚ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙˆØ³ÙŠØ· (â‹®)
document.getElementById("menuIcon").onclick = () => {
  const box = document.getElementById("menuDropdown");
  box.style.display = box.style.display === "none" ? "block" : "none";
};

// Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬Ù‡Ø§
document.addEventListener("click", (e) => {
  if (!e.target.closest("#menuIcon") && !e.target.closest("#menuDropdown")) {
    document.getElementById("menuDropdown").style.display = "none";
  }
});

// â­ ÙØªØ­ Ø§Ù„Ø¨Ø­Ø«
document.getElementById("searchIcon").onclick = () => {

  const icon = document.getElementById("searchIcon");

  // Ø¥Ø°Ø§ Ø§Ù„Ø¨Ø­Ø« Ù…ÙØ¹Ù„ â†’ Ø¥Ù„ØºØ§Ø¡Ù‡
  if (icon.dataset.activeSearch === "1") {
    localStorage.removeItem("activeSearch");
    localStorage.removeItem("searchQuery");
    icon.dataset.activeSearch = "0";
    icon.style.stroke = "#FF6B2D80";
    document.getElementById("searchInput").value = "";
    renderOrders(masterOrders);
    originalOrders = [...masterOrders];
    allOrdersList = [...masterOrders];
    return;
  }

  // ÙØªØ­ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¨Ø­Ø« + ØµÙ†Ø¯ÙˆÙ‚ Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø­Ø«
  document.getElementById("searchBoxContainer").style.display = "block";
  document.getElementById("searchTypeBox").style.display = "block";

  document.getElementById("ordersList").style.marginTop = "200px";
  document.getElementById("searchInput").focus();
};



// â­ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¨Ø­Ø«
document.getElementById("cancelSearch").onclick = () => {
  localStorage.removeItem("activeSearch");
  localStorage.removeItem("searchQuery");

  // ğŸ”¥ Ø¥Ø¹Ø§Ø¯Ø© Ù„ÙˆÙ† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø®Ø§ÙØª
  document.getElementById("searchIcon").style.stroke = "#FF6B2D80";
  document.getElementById("searchIcon").dataset.activeSearch = "0";

  document.getElementById("searchInput").value = "";
  document.getElementById("searchBoxContainer").style.display = "none";

  renderOrders(masterOrders);
  originalOrders = [...masterOrders];
  allOrdersList = [...masterOrders];
  document.getElementById("ordersList").style.marginTop = "0";
};


function normalizeNumber(str) {
  if (!str) return "";
  const arabic = ["Ù ","Ù¡","Ù¢","Ù£","Ù¤","Ù¥","Ù¦","Ù§","Ù¨","Ù©"];
  const english = ["0","1","2","3","4","5","6","7","8","9"];

  let out = str;
  arabic.forEach((a, i) => {
    out = out.replaceAll(a, english[i]);
  });
  return out;
}

// â­ ØªÙ†ÙÙŠØ° Ø§Ù„Ø¨Ø­Ø«
document.getElementById("doSearch").onclick = () => {
  const q = document.getElementById("searchInput").value.trim().toLowerCase();
  const qNorm = normalizeNumber(q);

  const type = searchType;

  localStorage.setItem("activeSearch", "1");
  localStorage.setItem("searchQuery", q);
  localStorage.setItem("searchType", type);

  if (q === "") return;

  // â­ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆÙ„ÙŠØ³ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© ÙÙ‚Ø·
const filtered = snapshotAllOrders.filter(o => {
    const id = normalizeNumber(String(o.id || "").toLowerCase());
    const phone1 = normalizeNumber(String(o.phone1 || "").toLowerCase());
    const phone2 = normalizeNumber(String(o.phone2 || "").toLowerCase());
    const code = normalizeNumber(String(o.customerCode || "").toLowerCase());

    if (type === "orderId") return id.includes(qNorm);
    if (type === "phone") return phone1.includes(qNorm) || phone2.includes(qNorm);
    if (type === "customerCode") return code.includes(qNorm);

    return false;
  });

  renderOrders(filtered);

  document.getElementById("searchIcon").style.stroke = "#FF6B2D";
  document.getElementById("searchIcon").dataset.activeSearch = "1";
  document.getElementById("ordersList").style.marginTop = "200px";
};



// â­ Ù†Ø¸Ø§Ù… ÙØªØ­/ØºÙ„Ù‚ Ø§Ù„Ø£ÙƒÙˆØ±Ø¯ÙŠÙ†
document.getElementById("accProdHeader").onclick = () => {
  const body = document.getElementById("accProdBody");
  body.style.display = body.style.display === "none" ? "block" : "none";
};

document.getElementById("accAdvHeader").onclick = () => {
  const body = document.getElementById("accAdvBody");
  body.style.display = body.style.display === "none" ? "block" : "none";
};

// â­ ÙØªØ­/Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙÙ„ØªØ±Ø© Ù…Ù† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©
document.getElementById("filterIcon").onclick = () => {
  const box = document.getElementById("filterBoxContainer");

 if (filterActive) {
    filterActive = false;

    // Ù…Ø³Ø­ Ø§Ù„ØªØ®Ø²ÙŠÙ† â† Ù‡Ø°Ø§ Ø£Ù‡Ù… Ø³Ø·Ø±
    localStorage.removeItem("filterActive");
    localStorage.removeItem("filterProducts");
    localStorage.removeItem("filterAdvertisers");

    // Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£ØµÙ„ÙŠ
    document.getElementById("filterIcon").style.stroke = "#FF6B2D80";

    renderOrders(masterOrders);
    allOrdersList = [...masterOrders];
    originalOrders = [...masterOrders];
    return;
}


  box.style.display = "block";
  document.getElementById("ordersList").style.marginTop = "150px";
};


document.getElementById("applyFilter").onclick = () => {

  // Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
  const selectedProducts = Array.from(
    document.querySelectorAll(".prodCheck:checked")
  ).map(el => el.value);

  // Ø§Ù„Ù…Ø¹Ù„Ù†ÙŠÙ† Ø§Ù„Ù…Ø®ØªØ§Ø±ÙŠÙ†
  const selectedAdvertisers = Array.from(
    document.querySelectorAll(".advCheck:checked")
  ).map(el => el.value);

  let filtered = masterOrders;
// â­ Ø­ÙØ¸ Ø§Ù„ÙÙ„Ø§ØªØ±
localStorage.setItem("filterProducts", JSON.stringify(selectedProducts));
localStorage.setItem("filterAdvertisers", JSON.stringify(selectedAdvertisers));
localStorage.setItem("filterActive", "1");

  // ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
  if (selectedProducts.length > 0) {
    filtered = filtered.filter(o => selectedProducts.includes(o.productName));
  }

  // ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ø¹Ù„Ù†ÙŠÙ†
  if (selectedAdvertisers.length > 0) {
    filtered = filtered.filter(o => selectedAdvertisers.includes(o.advertiser));
  }

  // ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙÙ„ØªØ±Ø© ÙˆØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©
  filterActive = true;
  document.getElementById("filterIcon").style.stroke = "#FF6B2D";

  renderOrders(filtered);
  originalOrders = [...filtered];
  allOrdersList = [...filtered];

  // Ø¥Ø®ÙØ§Ø¡ Ù†Ø§ÙØ°Ø© Ø§Ù„ÙÙ„ØªØ±Ø©
  document.getElementById("filterBoxContainer").style.display = "none";
  document.getElementById("ordersList").style.marginTop = "150px";
};




// â­ ØªØ­Ø¯ÙŠØ¯ ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
document.getElementById("prodSelectAll").onchange = (e) => {
  const checked = e.target.checked;
  document.querySelectorAll(".prodCheck").forEach(ch => ch.checked = checked);
};
// â­ ØªØ­Ø¯ÙŠØ¯ ÙƒÙ„ Ø§Ù„Ù…Ø¹Ù„Ù†ÙŠÙ†
document.getElementById("advSelectAll").onchange = (e) => {
  const checked = e.target.checked;
  document.querySelectorAll(".advCheck").forEach(ch => ch.checked = checked);
};
// â­ Ø¨Ø­Ø« Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
document.getElementById("prodSearch").oninput = () => {
  const q = document.getElementById("prodSearch").value.toLowerCase();
  document.querySelectorAll("#prodList label").forEach(lbl => {
    const txt = lbl.textContent.toLowerCase();
    lbl.style.display = txt.includes(q) ? "flex" : "none";
  });
};

// â­ Ø¨Ø­Ø« Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¹Ù„Ù†ÙŠÙ†
document.getElementById("advSearch").oninput = () => {
  const q = document.getElementById("advSearch").value.toLowerCase();
  document.querySelectorAll("#advList label").forEach(lbl => {
    const txt = lbl.textContent.toLowerCase();
    lbl.style.display = txt.includes(q) ? "flex" : "none";
  });
};
let searchType = "orderId";

// Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø­Ø«
document.querySelectorAll(".searchTypeBtn").forEach(btn => {
  btn.onclick = () => {
    searchType = btn.dataset.type;

    // ØªØºÙŠÙŠØ± Ø´ÙƒÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    document.querySelectorAll(".searchTypeBtn").forEach(x => {
      x.style.background = "white";
    });
    btn.style.background = "#E6F3FF";
  };
});

// Ø²Ø± Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¨Ø­Ø«
document.getElementById("closeSearch").onclick = () => {
  document.getElementById("searchBoxContainer").style.display = "none";
  document.getElementById("ordersList").style.marginTop = "0px";
};





</script>

</body>
</html> 